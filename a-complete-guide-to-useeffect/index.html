<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><style data-href="/blog/styles.9a3dbd9b4a5805a7d38f.css" id="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format("woff");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmhdu3cOWxy40.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwkxdu3cOWxy40.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmxdu3cOWxy40.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmRdu3cOWxy40.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlxdu3cOWxw.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lujVj9_mf.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lujVj9_mf.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lujVj9_mf.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lujVj9_mf.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lujVj9_mf.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lujVj9_mf.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmhdu3cOWxy40.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwkxdu3cOWxy40.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmxdu3cOWxy40.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmRdu3cOWxy40.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdu3cOWxw.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}html{scroll-behavior:smooth}body{--body-color:#c4b6fd;--font:"Source Sans Pro","Helvetica Neue",Arial,sans-serif;background-color:var(--bg);font-family:var(--font)}::selection{background-color:var(--body-color);color:#fff}body.light{--bg:#fff;--bg-secondary:#f9fafb;--header:var(--body-color);--textNormal:#2c3e50;--textTitle:#2c3e50;--textLink:#a88bfa;--hr:rgba(0,0,0,0.2);--inlineCode-bg:#f8f8f8;--inlineCode-text:#d63200;--form-shadow:0 2px 15px 0 rgba(210,214,220,0.5)}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--bg-secondary:#363c48;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--body-color);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#ffe56433;--inlineCode-text:#e6e6e6;--form-shadow:0 2px 15px 0 rgba(26,26,27,0.637)}h1,h2,h3,h4,h5,h6{font-family:var(--font)}a{box-shadow:none;text-decoration:none}a:hover{text-decoration:underline}mark{background:#f59e0b}.title_list{list-style:none}.title_list article section p{color:#8aa4be}.title_list h3{margin-bottom:5px}.title_list a{color:var(--textTitle)}.title_list a:hover{color:var(--textLink);text-decoration:none}.bio-avatar{margin-bottom:20px}:not(pre)>code[class*=language-]{background:var(--inlineCode-bg);border-radius:.3em;color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.gatsby-highlight-code-line{background-color:#022a4b;border-left:.25em solid #ffa7c4;display:block;padding-left:1.25em;padding-right:1em}.gatsby-highlight,.gatsby-highlight-code-line{margin-left:-1.3125rem;margin-right:-1.3125rem}.gatsby-highlight{-webkit-overflow-scrolling:touch;background:#011627;border-radius:10px;margin-bottom:1.75rem;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}code[class*=language-],pre[class*=language-]{font-feature-settings:normal;word-wrap:normal;background:none;color:#fff;font-family:Roboto Mono,Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{background:hsla(0,0%,100%,.15);text-shadow:none}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.react-toggle{-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;background-color:transparent;border:0;cursor:pointer;display:inline-block;padding:0;position:relative;touch-action:pan-x;-webkit-user-select:none;-ms-user-select:none;user-select:none}.react-toggle-screenreader-only{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{background-color:#0f1114;border-radius:30px;height:24px;padding:0;transition:all .2s ease;width:50px}.react-toggle-track-check{bottom:0;height:17px;left:5px;line-height:0;margin-bottom:auto;margin-top:auto;opacity:0;position:absolute;top:0;transition:opacity .25s ease;width:17px}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{bottom:0;height:17px;line-height:0;margin-bottom:auto;margin-top:auto;position:absolute;right:5px;top:0;width:17px}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{background-color:#fafafa;border-radius:50%;box-sizing:border-box;height:22px;left:1px;position:absolute;top:1px;transform:translateX(0);transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;width:22px}.react-toggle--checked .react-toggle-thumb{border-color:#19ab27;transform:translateX(26px)}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #c4b6fd}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #c4b6fd}h3.title{margin-bottom:28px;padding-left:15px}ul.table_list{border-radius:.25rem;bottom:2rem;display:flex;flex-direction:column;left:calc(50% + 400px);margin-bottom:.75rem;margin-top:.75rem;max-height:40rem;max-width:15rem;position:fixed;top:2rem}.table_list li{line-height:1rem;list-style:none;margin-bottom:1em;padding:.25rem}.table_list a{color:var(--color-primary);text-decoration:none}.table_list a.active,.table_list a:hover{color:#a78bfa;text-decoration:none;transition-duration:.3s}.table_list a.active{border-radius:.125rem}.headings{overflow:auto}</style><meta name="generator" content="Gatsby 3.6.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8f03a5daec1c1aec2f99e70f83851e31" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#a88bfa"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><title data-react-helmet="true">ç†è§£ useEffect | Fish&#x27;s Blog</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="A Complete Guide to useEffect"/><meta data-react-helmet="true" property="og:title" content="ç†è§£ useEffect"/><meta data-react-helmet="true" property="og:description" content="A Complete Guide to useEffect"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="icyfish_"/><meta data-react-helmet="true" name="twitter:title" content="ç†è§£ useEffect"/><meta data-react-helmet="true" name="twitter:description" content="A Complete Guide to useEffect"/><link as="script" rel="preload" href="/blog/webpack-runtime-45df45a5891ba014dba8.js"/><link as="script" rel="preload" href="/blog/framework-b2b1b62bddbed1246653.js"/><link as="script" rel="preload" href="/blog/app-2226f01a9ae9a3fde7ee.js"/><link as="script" rel="preload" href="/blog/commons-ff66217271001e5b3970.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-js-49536cdc753c1e44b042.js"/><link as="fetch" rel="preload" href="/blog/page-data/a-complete-guide-to-useeffect/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:#c4b6fd" href="/blog/">Fish&#x27;s Blog</a></h3><div style="height:24px"></div></header><ul class="table_list"><h3 class="title">Table of contents</h3><div class="headings"><li style="margin-left:20px"><a href="#æ­£æ–‡" class="">æ­£æ–‡</a></li><li style="margin-left:30px"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„-props-å’Œ-state" class="">æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ Props å’Œ State</a></li><li style="margin-left:30px"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨" class="">æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨</a></li><li style="margin-left:30px"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨" class="">æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨</a></li><li style="margin-left:30px"><a href="#æ¯æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å€¼éƒ½å±äºå½“æ¬¡æ¸²æŸ“" class="">æ¯æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å€¼éƒ½å±äºå½“æ¬¡æ¸²æŸ“</a></li><li style="margin-left:30px"><a href="#é€†æµè€Œä¸Š" class="">é€†æµè€Œä¸Š</a></li><li style="margin-left:30px"><a href="#æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°" class="">æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°</a></li><li style="margin-left:30px"><a href="#åŒæ­¥-è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ" class="">åŒæ­¥ è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ</a></li><li style="margin-left:30px"><a href="#å‘Šè¯‰-react-å¦‚ä½•åŒºåˆ«å‰¯ä½œç”¨å‡½æ•°çš„å˜åŒ–" class="">å‘Šè¯‰ React å¦‚ä½•åŒºåˆ«å‰¯ä½œç”¨å‡½æ•°çš„å˜åŒ–</a></li><li style="margin-left:30px"><a href="#è¦ç¡®ä¿ä¾èµ–æ•°ç»„ä¸­å‚æ•°çš„å‡†ç¡®æ€§-ä¸è¦æ¬ºéª—-react" class="">è¦ç¡®ä¿ä¾èµ–æ•°ç»„ä¸­å‚æ•°çš„å‡†ç¡®æ€§ ä¸è¦æ¬ºéª— React</a></li><li style="margin-left:30px"><a href="#å½“ä½ å¯¹-react-æ’’è°-ä¼ å…¥äº†é”™è¯¯çš„ä¾èµ–å‚æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ" class="">å½“ä½ å¯¹ React æ’’è° ä¼ å…¥äº†é”™è¯¯çš„ä¾èµ–å‚æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ</a></li><li style="margin-left:30px"><a href="#ä¸¤ç§å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼" class="">ä¸¤ç§å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼</a></li><li style="margin-left:30px"><a href="#ç”¨å‡½æ•°çš„æ–¹å¼æ›´æ–°çŠ¶æ€" class="">ç”¨å‡½æ•°çš„æ–¹å¼æ›´æ–°çŠ¶æ€</a></li><li style="margin-left:30px"><a href="#å‡½æ•°å¼æ›´æ–°ä¸-google-docs" class="">å‡½æ•°å¼æ›´æ–°ä¸ Google Docs</a></li><li style="margin-left:30px"><a href="#å°†çŠ¶æ€æ›´æ–°ä»-actions-ä¸­è§£è€¦" class="">å°†çŠ¶æ€æ›´æ–°ä» actions ä¸­è§£è€¦</a></li><li style="margin-left:30px"><a href="#ä¸ºä»€ä¹ˆ-usereducer-æ˜¯-hooks-çš„æ¬ºéª—æ¨¡å¼" class="">ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„æ¬ºéª—æ¨¡å¼</a></li><li style="margin-left:30px"><a href="#å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å†…éƒ¨" class="">å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å†…éƒ¨</a></li><li style="margin-left:30px"><a href="#æ— æ³•å°†å‡½æ•°ç§»å…¥å‰¯ä½œç”¨å†…éƒ¨çš„æƒ…å†µ" class="">æ— æ³•å°†å‡½æ•°ç§»å…¥å‰¯ä½œç”¨å†…éƒ¨çš„æƒ…å†µ</a></li><li style="margin-left:30px"><a href="#å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—" class="">å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—</a></li><li style="margin-left:30px"><a href="#ç«é€Ÿåœºæ™¯" class="">ç«é€Ÿåœºæ™¯</a></li><li style="margin-left:30px"><a href="#è¿›ä¸€æ­¥æ·±å…¥" class="">è¿›ä¸€æ­¥æ·±å…¥</a></li><li style="margin-left:30px"><a href="#æ€»ç»“" class="">æ€»ç»“</a></li></div></ul><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">ç†è§£ useEffect</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">July 02, 2021<span style="margin-left:10px">ğŸ±ğŸ±ğŸ±ğŸ± 51 min read</span></p></header><section itemProp="articleBody"><p>åŸæ–‡: <a href="https://overreacted.io/a-complete-guide-to-useeffect/">A Complete Guide to useEffect</a></p>
<ul>
<li class="task-list-item"><input type="checkbox" disabled> å®Œå–„ä¸€äº›ä¸ç†è§£çš„æ®µè½</li>
<li class="task-list-item">
<p><input type="checkbox" disabled> TLDRéƒ¨åˆ†</p>
<h2 id="æ­£æ–‡" style="position:relative;"><a href="#%E6%AD%A3%E6%96%87" aria-label="æ­£æ–‡ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ­£æ–‡</h2>
<h3 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„-props-å’Œ-state" style="position:relative;"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84-props-%E5%92%8C-state" aria-label="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ props å’Œ state permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ Props å’Œ State</h3>
</li>
</ul>
<p>å¼€å§‹èŠ effect ä¹‹å‰, æˆ‘ä»¬å…ˆå¼€å§‹èŠä¸€èŠç»„ä»¶çš„æ¸²æŸ“.</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ç»„ä»¶. å…³æ³¨å…¶ä¸­é«˜äº®çš„éƒ¨åˆ†:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä»¥ä¸Šçš„ä»£ç å®é™…ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆå‘¢? <code class="language-text">count</code> æ˜¯ä¸æ˜¯åœ¨æ—¶åˆ»å…³æ³¨æˆ‘ä»¬çš„çŠ¶æ€(state)å˜åŒ–, ç„¶åæ ¹æ®è¿™ä¸ªå˜åŒ–è‡ªåŠ¨æ›´æ–°å‘¢? è¿™ä¸ªçŒœæµ‹ååˆ†ç¬¦åˆç›´è§‰, å¦‚æœä½ æ˜¯ React åˆå­¦è€…, è¿™ä¸ªæƒ³æ³•å¯èƒ½ä¼šä¸ºä½ ç†è§£ React å¸¦æ¥æ¯”è¾ƒå¤§çš„å¸®åŠ©. ä½†æ˜¯å®é™…ä¸Š, è¿™ä¸ªç†è§£å¹¶ä¸å‡†ç¡®. æˆ‘å†™è¿‡ä¸€ç¯‡å…³äºè¿™ä¸ªè¯é¢˜çš„æ–‡ç« , è¿™æ‰æ˜¯<a href="https://overreacted.io/react-as-a-ui-runtime/">å‡†ç¡®çš„å¿ƒæ™ºæ¨¡å‹</a></p>
<p><strong>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code class="language-text">count</code> ä»…ä»…æ˜¯ä¸ªæ•°å­—è€Œå·².</strong> å†…éƒ¨å¹¶æ²¡æœ‰â€æ•°æ®ç»‘å®šâ€, â€œè§‚å¯Ÿè€…â€, â€œä»£ç†â€ç­‰ç­‰çš„é€»è¾‘. å°±åƒä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸€æ ·, å®ƒä»…ä»…åªæ˜¯ä¸€ä¸ªæ•°å­—:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">42</span>
<span class="token comment">// ...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token comment">// ...</span></code></pre></div>
<p>å½“ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™, ä» <code class="language-text">useState()</code> ä¸­è¯»å–åˆ°çš„ <code class="language-text">count</code> æ˜¯ <code class="language-text">0</code>. å½“æˆ‘ä»¬è°ƒç”¨äº† <code class="language-text">setCount(1)</code> ä¹‹å, React ä¼šé‡æ–°è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶. è¿™ä¸€æ¬¡ <code class="language-text">count</code> å€¼å°†ä¼šæ˜¯ <code class="language-text">1</code>, ä»¥æ­¤ç±»æ¨:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token punctuation">;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç‚¹å‡»äº‹ä»¶ä¹‹å, å‡½æ•° (Counterç»„ä»¶) å†æ¬¡è¢«è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¬¬äºŒæ¬¡ç‚¹å‡»äº‹ä»¶ä¹‹å, å‡½æ•° (Counterç»„ä»¶) å†æ¬¡è¢«è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æ— è®ºä½•æ—¶, çŠ¶æ€æ›´æ–°ä¹‹å, React éƒ½ä¼šé‡æ–°è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶. æ¯ä¸€æ¬¡æ¸²æŸ“çš„ç»“æœéƒ½ä¼šâ€çœ‹åˆ°â€ç»„ä»¶å†…éƒ¨çš„ <code class="language-text">count</code> çŠ¶æ€å€¼, è€Œè¿™ä¸ªå€¼åœ¨å‡½æ•°ä¸­å®é™…ä¸Šæ˜¯ä¸€ä¸ª<em>å¸¸é‡</em>.</strong></p>
<p>æ‰€ä»¥è¯´ä»¥ä¸‹è¿™ä¸€è¡Œä»£ç å¹¶æ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šé€»è¾‘:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p><strong>å®ƒä»…ä»…åªæ˜¯å°†æ•°å­—çš„å€¼æ·»åŠ åˆ°æ¸²æŸ“ç»“æœä¸­è€Œå·².</strong> è¿™ä¸ªæ•°å­—ç”± React æä¾›. å½“æˆ‘ä»¬è°ƒç”¨ <code class="language-text">setCount</code> çš„æ—¶å€™, React ä¼šç”¨ä¸€ä¸ªæœ€æ–°çš„ <code class="language-text">count</code> å€¼æ¥é‡æ–°è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶. ç„¶å React æ›´æ–° DOM, ä»¥åŒ¹é…æœ€æ–°çš„æ¸²æŸ“ç»“æœ.</p>
<p>è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯: <code class="language-text">count</code> å€¼åœ¨æ¯æ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­, éƒ½æ˜¯ä¸€ä¸ªå›ºå®šçš„å¸¸é‡. åªæœ‰ç»„ä»¶è¢«é‡æ–°è°ƒç”¨, æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½â€çœ‹åˆ°äº†â€å¯¹åº”çš„ <code class="language-text">count</code> å€¼, åŒæ—¶æ¯ä¸€æ¬¡æ¸²æŸ“çš„ <code class="language-text">count</code> éƒ½äº’ä¸å…³è”.</p>
<p><em>(æƒ³è¦æ›´æ·±å…¥åœ°äº†è§£å…·ä½“çš„æ¸²æŸ“æµç¨‹, å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« : <a href="https://overreacted.io/react-as-a-ui-runtime/">React ä½œä¸º UI è¿è¡Œæ—¶</a>)</em></p>
<h3 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨" style="position:relative;"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8" aria-label="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨</h3>
<p>æ¥ä¸‹æ¥å¼€å§‹çœ‹äº‹ä»¶å¤„ç†å™¨.</p>
<p>æŸ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹. æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª 3 ç§’çš„å®šæ—¶å™¨, 3 ç§’ä¹‹åå¼¹å‡º <code class="language-text">count</code> å€¼:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Show alert</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç°åœ¨æˆ‘æŒ‰æ­¥éª¤åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…:</p>
<ul>
<li>å°†è®¡æ—¶å™¨çš„å€¼<strong>å¢åŠ </strong>åˆ° 3</li>
<li><strong>ç‚¹å‡»</strong>â€œShow alertâ€</li>
<li>åœ¨å®šæ—¶å™¨çš„å›è°ƒ(<code class="language-text">alert</code>å‡½æ•°)æ‰§è¡Œä¹‹å‰å°†è®¡æ—¶å™¨çš„å€¼<strong>å¢åŠ </strong>åˆ° 5</li>
</ul>
<p><img src="/blog/46c55d5f1f749462b7a173f1e748e41e/counter.gif" alt="counter"></p>
<p>ä½ è®¤ä¸º <code class="language-text">alert</code> çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢? æ˜¯ <code class="language-text">alert</code> æ—¶çš„ state å€¼ 5, è¿˜æ˜¯ç‚¹å‡»æ—¶çš„ state å€¼ 3?</p>
<hr>
<p><em>å‰§é€:</em></p>
<hr>
<p>å¯ä»¥åœ¨<a href="https://codesandbox.io/s/w2wxl3yo0l">è¿™é‡Œ</a>è‡ªå·±è¯•ä¸€è¯•!</p>
<p>å¦‚æœè¿™ä¸ªç¤ºä¾‹å¯¹ä½ æ¥è¯´å¾ˆè´¹è§£, å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­: å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªèŠå¤©åº”ç”¨, æˆ‘ä»¬å°† count ç±»æ¯”ä¸ºå½“å‰æ¥å—çš„æ¶ˆæ¯å¯¹åº”çš„ ID, å­˜å‚¨åœ¨ state ä¸­, å°†æŒ‰é’®ç±»æ¯”ä¸ºå‘é€æ¶ˆæ¯çš„æŒ‰é’®, è¿™æ ·å¯èƒ½ä¼šæ›´å®¹æ˜“ç†è§£. </p>
<p><a href="https://overreacted.io/how-are-function-components-different-from-classes/">è¿™ç¯‡æ–‡ç« </a>è¯¦ç»†è§£é‡Šäº†å‡ºç°ä¸Šè¿°ç»“æœçš„åŸå› , æ­£ç¡®ç­”æ¡ˆæ˜¯ 3.</p>
<p><code class="language-text">alert</code> ä¼šâ€æ•æ‰â€ç‚¹å‡»å½“æ—¶ state çš„å€¼.</p>
<p>(<em>å½“ç„¶, æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä»£ç ä»¥å®ç°å…¶ä»–çš„è¡Œä¸º, ä½†æ˜¯ç›®å‰æˆ‘åªå…³æ³¨é»˜è®¤åœºæ™¯. å½“æˆ‘ä»¬åœ¨å»ºç«‹ä¸€ä¸ªå…¨æ–°å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™, è¦å°½å¯èƒ½é€‰æ‹©æœ€ç®€å•çš„æ–¹å¼, è¿™æ ·èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°å»ºç«‹å…¨æ–°çš„å¿ƒæ™ºæ¨¡å‹.</em>)</p>
<hr>
<p>é‚£ä¹ˆå…¶ä¸­çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢?</p>
<p>æˆ‘ä»¬å…ˆå‰æåˆ°è¿‡, <code class="language-text">count</code> å€¼åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡. æœ‰å¿…è¦é‡ç‚¹æŒ‡å‡ºçš„æ˜¯ â€” <strong>æˆ‘ä»¬çš„å‡½æ•°(ç»„ä»¶)ä¼šè¢«è°ƒç”¨å¤šæ¬¡(æ¯æ¬¡æ¸²æŸ“è¢«è°ƒç”¨ä¸€æ¬¡), æ¯ä¸€æ¬¡è¢«è°ƒç”¨æ—¶, è¿™ä¸ª count éƒ½æ˜¯ç”± useState æ§åˆ¶çš„ä¸€ä¸ªç‰¹å®šå€¼.</strong></p>
<p>è¿™ä¸ªç‰¹æ€§å¹¶é React ç‹¬æœ‰ â€” æ™®é€šçš„å‡½æ•°ä¹Ÿæ˜¯è¿™æ ·å·¥ä½œçš„:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>name</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> someone <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Dan"</span> <span class="token punctuation">}</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Yuzhi"</span> <span class="token punctuation">}</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Dominic"</span> <span class="token punctuation">}</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span></code></pre></div>
<p>åœ¨è¿™ä¸ª<a href="https://codesandbox.io/s/mm6ww11lk8">ç¤ºä¾‹</a>ä¸­, å¤–éƒ¨çš„ <code class="language-text">someone</code> å˜é‡è¢«å¤šæ¬¡é‡æ–°èµ‹å€¼. (å°±åƒåœ¨ React ä¸­, å½“å‰ç»„ä»¶çš„ state ä¸æ–­å˜åŒ–ä¸€æ ·. ) <strong>åœ¨ <code class="language-text">sayHi</code> å†…éƒ¨, æœ‰ä¸€ä¸ªå˜é‡ <code class="language-text">name</code>, å®ƒä¼šè¯»å– <code class="language-text">person</code> çš„ <code class="language-text">name</code> å±æ€§.</strong> è¿™ä¸ªå˜é‡åœ¨å‡½æ•°å†…éƒ¨, æ¯æ¬¡è°ƒç”¨ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„. å› æ­¤, å½“å®šæ—¶å™¨çš„å›è°ƒè¢«è°ƒç”¨çš„æ—¶å€™, æ¯æ¬¡ alert éƒ½ä¼šâ€è®°ä½â€å½“æ—¶çš„ <code class="language-text">name</code>.</p>
<p>è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å™¨æ˜¯å¦‚ä½•åœ¨ç‚¹å‡»çš„å½“ä¸‹â€æ•æ‰â€ <code class="language-text">count</code> å€¼çš„. åŒç†, æ¯æ¬¡æ¸²æŸ“éƒ½èƒ½â€çœ‹åˆ°â€è‡ªå·±çš„ <code class="language-text">count</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç‚¹å‡»äº‹ä»¶ä¹‹åå‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆä¸€æ¬¡ç‚¹å‡»äº‹ä»¶, å‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// useState() è¿”å›çš„å†…å®¹</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ¯ä¸€æ¬¡æ¸²æŸ“, éƒ½ä¼šè¿”å›å„è‡ªç‰ˆæœ¬çš„ <code class="language-text">handleAlertClick</code>, å¹¶ä¸”æœ‰å„è‡ªçš„ <code class="language-text">count</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// å†…éƒ¨å€¼ä¸º 0 çš„ç‰ˆæœ¬</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç‚¹å‡»äº‹ä»¶ä¹‹åå‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// å†…éƒ¨å€¼ä¸º 1 çš„ç‰ˆæœ¬</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆä¸€æ¬¡ç‚¹å‡»äº‹ä»¶, å‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You clicked on: "</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// å†…éƒ¨å€¼ä¸º 2 çš„ç‰ˆæœ¬</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ, åœ¨è¿™é‡Œçš„<a href="https://codesandbox.io/s/w2wxl3yo0l">ç¤ºä¾‹</a>ä¸­, äº‹ä»¶å¤„ç†å™¨â€å±äºâ€å„è‡ªçš„æ¸²æŸ“, å½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™, ä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“çš„ <code class="language-text">count</code> å€¼.</p>
<p><strong>å¯¹äºæ¯ä¸€æ¬¡æ¸²æŸ“, å†…éƒ¨çš„ props å’Œ state å§‹ç»ˆä¿æŒä¸å˜, å¹¶ä¸”æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ç‹¬ç«‹çš„.</strong> æ—¢ç„¶æ¯æ¬¡æ¸²æŸ“çš„ props å’Œ state å„è‡ªç‹¬ç«‹, æ¶ˆè´¹å®ƒä»¬çš„éƒ¨åˆ†(åŒ…æ‹¬äº‹ä»¶å¤„ç†å™¨), åœ¨æ¸²æŸ“é—´ä¹Ÿå„è‡ªç‹¬ç«‹, éƒ½ä»å±äºç‰¹å®šçš„æ¸²æŸ“. å› æ­¤äº‹ä»¶å¤„ç†å™¨å†…éƒ¨çš„å¼‚æ­¥å‡½æ•°ä¹Ÿä¼šâ€çœ‹åˆ°â€åŒæ ·çš„ <code class="language-text">count</code> å€¼.</p>
<p><em>è¾¹æ³¨: æˆ‘åœ¨ <code class="language-text">handleAlertClick</code> ä¸­ç›´æ¥ä½¿ç”¨äº† <code class="language-text">count</code> å€¼. è¿™æ ·çš„æ›¿æ¢æ˜¯å®‰å…¨çš„, å› ä¸ºåœ¨ä¸€æ¬¡æ¸²æŸ“æµç¨‹ä¸­, <code class="language-text">count</code> å€¼ä¸å¯èƒ½æœ‰å˜åŒ–. å®ƒè¢«å£°æ˜ä¸º <code class="language-text">const</code>, ä¸”æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ•°å­—. åŒæ ·çš„åŸåˆ™åœ¨å¯¹è±¡ä¸­ä»ç„¶é€‚ç”¨, ä¸è¿‡æˆ‘ä»¬å¿…é¡»è¦ç¡®ä¿é¿å…æ”¹å˜(mutate)çŠ¶æ€çš„å€¼. åšæ³•æ˜¯ç”¨ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡å»è°ƒç”¨ <code class="language-text">setSomething(newObj)</code>, è€Œä¸æ”¹å˜è¿™ä¸ªå¯¹è±¡. è¿™æ ·çš„è¯, å‰ä¸€æ¬¡æ¸²æŸ“çš„çŠ¶æ€(state)å€¼å°±èƒ½å¤Ÿä¿æŒä¸è¢«ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¿®æ”¹.</em></p>
<h3 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨" style="position:relative;"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8" aria-label="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨</h3>
<p>è¿™ç¯‡æ–‡ç« çš„ä¸»è¦å†…å®¹æœ¬è¯¥æ˜¯å…³äºå‰¯ä½œç”¨å‡½æ•°(effect)çš„, ç°åœ¨æˆ‘ä»¬ä¼šå¼€å§‹è¯¦ç»†ä»‹ç»å®ƒ. å…¶å®, å‰¯ä½œç”¨å’Œä»¥ä¸Šä¸¤éƒ¨åˆ†çš„è¡Œä¸ºç±»ä¼¼, æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„å‰¯ä½œç”¨å‡½æ•°.</p>
<p>æˆ‘ä»¬å›åˆ° React <a href="https://reactjs.org/docs/hooks-effect.html">æ–‡æ¡£</a>ä¸­çš„ä¾‹å­:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜: effect æ˜¯å¦‚ä½•è¯»å–åˆ° <code class="language-text">count</code> çš„æœ€æ–°å€¼çš„?</strong></p>
<p>åœ¨ effect å‡½æ•°çš„å†…éƒ¨æœ‰ä¸€äº›æ•°æ®ç»‘å®šæˆ–è€…è®¢é˜…çš„é€»è¾‘, ä½¿å¾— effect å‡½æ•°æ¯æ¬¡éƒ½èƒ½è¯»å–åˆ° <code class="language-text">count</code> çš„æœ€æ–°å€¼? è¿˜æ˜¯ <code class="language-text">count</code> æ˜¯ä¸€ä¸ªå¯å˜çš„å€¼, React åœ¨ç»„ä»¶çš„å†…éƒ¨ç»´æŠ¤äº†è¿™ä¸ªå€¼, å› æ­¤æˆ‘ä»¬çš„ effect å‡½æ•°èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°å€¼?</p>
<p>éƒ½ä¸æ˜¯çš„.</p>
<p>å…ˆå‰æˆ‘ä»¬å·²ç»çŸ¥é“, <code class="language-text">count</code> åœ¨æ¯æ¬¡ç‰¹å®šçš„ç»„ä»¶æ¸²æŸ“æµç¨‹ä¸­, éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡. äº‹ä»¶å¤„ç†å™¨ä»å®ƒæ‰€å±çš„æ¸²æŸ“æµç¨‹ä¸­è¯»å–åˆ°äº†å¯¹åº”çš„ <code class="language-text">count</code> å€¼, å› ä¸º <code class="language-text">count</code> æ˜¯å¤„äºå¯¹åº”ä½œç”¨åŸŸçš„å˜é‡. åœ¨ effect å‡½æ•°ä¸­ä¹Ÿä¸ä¾‹å¤–!</p>
<p><strong>å¹¶ä¸æ˜¯åœ¨ä¸€ä¸ªâ€ä¸ä¼šå˜åŒ–â€çš„å‰¯ä½œç”¨æ–¹æ³•ä¸­, <code class="language-text">count</code> å˜é‡å€¼æ—¶åˆ»å˜åŒ–. è€Œæ˜¯æ¯ä¸€æ¬¡æ¸²æŸ“, å‰¯ä½œç”¨å‡½æ•°æœ¬èº«éƒ½ä¸ä¸€æ ·.</strong></p>
<p>åŒæ ·åœ°, æ¯ä¸ªç‰ˆæœ¬çš„å‰¯ä½œç”¨æ–¹æ³•è¯»å–åˆ°çš„éƒ½æ˜¯å½“æ¬¡æ¸²æŸ“å†…çš„ <code class="language-text">count</code> å€¼:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// é¦–æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç‚¹å‡»äº‹ä»¶ä¹‹åå‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆä¸€æ¬¡ç‚¹å‡»äº‹ä»¶, å‡½æ•°è¢«é‡æ–°è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ç¬¬ä¸‰æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span></code></pre></div>
<p>React ä¼šè®°ä½æ¯ä¸€æ¬¡ä½ æ‰€æä¾›çš„å‰¯ä½œç”¨æ–¹æ³•, åœ¨å½“æ¬¡æ¸²æŸ“æµç¨‹ç»“æŸ, UI å‘ˆç°å‡ºå¯¹åº”å˜åŒ–ä¹‹å, è°ƒç”¨è¿™ä¸ªå‰¯ä½œç”¨æ–¹æ³•.</p>
<p>å°½ç®¡æ¯ä¸€æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨æ–¹æ³•çœ‹èµ·æ¥æ²¡æœ‰å·®åˆ«(åŠŸèƒ½éƒ½æ˜¯æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜), ä½†æ˜¯å®é™…ä¸Šæ¯ä¸€æ¬¡æ¸²æŸ“è¿™ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸ä¸€æ ·çš„ â€” å¹¶ä¸”æ¯ä¸€ä¸ªå‰¯ä½œç”¨æ–¹æ³•éƒ½ä¼šçœ‹åˆ°â€æ¸²æŸ“â€å½“æ¬¡çš„ props å’Œ state.</p>
<p><strong>ä¸ºäº†ä¾¿äºç†è§£, ä½ å¯ä»¥æŠŠå‰¯ä½œç”¨æ–¹æ³•å½“åšæ˜¯æ¯æ¬¡æ¸²æŸ“çš„ç»“æœ.</strong></p>
<p>ä½†ä¸¥æ ¼æ¥è¯´, å®ƒä»¬å¹¶ä¸æ˜¯æ¸²æŸ“ç»“æœ(React ä¸å°†å‰¯ä½œç”¨å‡½æ•°è®¾è®¡ä¸ºæ¸²æŸ“ç»“æœçš„åŸå› æ˜¯: èƒ½å¤Ÿé€šè¿‡ç®€å•çš„è¯­æ³•<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/">å®ç° Hooks çš„ç»„åˆ</a>, å‡å°‘è¿è¡Œæ—¶çš„å¼€é”€). ä½†æ˜¯è€ƒè™‘åˆ°æˆ‘ä»¬ç°åœ¨çš„ç›®çš„æ˜¯å»ºç«‹å…¨æ–°çš„å¿ƒæ™ºæ¨¡å‹, å¯ä»¥åœ¨æ¦‚å¿µä¸Šè®¤ä¸ºå‰¯ä½œç”¨å‡½æ•°æ˜¯æŸä¸€æ¬¡æ¸²æŸ“çš„ç»“æœ.</p>
<hr>
<p>ç°åœ¨æ¥å·©å›ºä»¥ä¸Šçš„å†…å®¹, é¦–å…ˆå›é¡¾é¦–æ¬¡æ¸²æŸ“:</p>
<ul>
<li><strong>React:</strong> å½“ state å€¼ä¸º <code class="language-text">0</code> çš„æ—¶å€™, ç»™æˆ‘ä½ å¸Œæœ›æ¸²æŸ“çš„ UI å†…å®¹.</li>
<li>
<p><strong>ç»„ä»¶:</strong></p>
<ul>
<li>è¿™æ˜¯æˆ‘è¦æ¸²æŸ“çš„å†…å®¹: <code class="language-text">&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li>
<li>æ¸²æŸ“ç»“æŸä¹‹åè¯·æ‰§è¡Œè¿™ä¸ªå‰¯ä½œç”¨æ–¹æ³•: <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>
</ul>
</li>
<li><strong>React:</strong> å¥½çš„, æ›´æ–° UI. Hey, æµè§ˆå™¨, æˆ‘æƒ³è¦åœ¨ DOM ä¸­æ·»åŠ ä¸€äº›å†…å®¹.</li>
<li><strong>æµè§ˆå™¨:</strong> å¥½çš„, æˆ‘æŠŠå®ƒä»¬ç»˜åˆ¶åˆ°å±å¹•ä¸­.</li>
<li>
<p><strong>React:</strong> å¥½çš„, æˆ‘å‡†å¤‡å¼€å§‹æ‰§è¡Œå‰¯ä½œç”¨æ–¹æ³•äº†.</p>
<ul>
<li>æ‰§è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>
</ul>
</li>
</ul>
<hr>
<p>ç„¶åå›é¡¾ç‚¹å‡»ä¹‹åçš„æ¸²æŸ“æµç¨‹:</p>
<ul>
<li><strong>ç»„ä»¶:</strong> Hey, React, æŠŠæˆ‘çŠ¶æ€(state)ä¸­çš„ <code class="language-text">count</code> å€¼è®¾ç½®ä¸º <code class="language-text">1</code>.</li>
<li><strong>React:</strong> å½“ <code class="language-text">count</code> æ›´æ–°ä¸º <code class="language-text">1</code> çš„æ—¶å€™, æŠŠå¯¹åº”çš„ UI è¿”å›ç»™æˆ‘å§.</li>
<li>
<p><strong>ç»„ä»¶:</strong></p>
<ul>
<li>è¿™æ˜¯æ¸²æŸ“çš„ç»“æœ: <code class="language-text">&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li>
<li>è®°å¾—æ‰§è¡Œè¿™ä¸ªå‰¯ä½œç”¨æ–¹æ³•: <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>
</ul>
</li>
<li><strong>React:</strong> å¥½çš„, æ›´æ–° UI. Hey, æµè§ˆå™¨, æˆ‘å·²ç»ä¿®æ”¹å¥½ DOM äº†.</li>
<li><strong>æµè§ˆå™¨:</strong> å¥½çš„, æˆ‘æŠŠå®ƒä»¬ç»˜åˆ¶åˆ°å±å¹•ä¸­.</li>
<li>
<p><strong>React:</strong> OK, æˆ‘ç°åœ¨å¼€å§‹æ‰§è¡Œå‰¯ä½œç”¨æ–¹æ³•.</p>
<ul>
<li>æ‰§è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="æ¯æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å€¼éƒ½å±äºå½“æ¬¡æ¸²æŸ“" style="position:relative;"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%9A%84%E6%89%80%E6%9C%89%E5%80%BC%E9%83%BD%E5%B1%9E%E4%BA%8E%E5%BD%93%E6%AC%A1%E6%B8%B2%E6%9F%93" aria-label="æ¯æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å€¼éƒ½å±äºå½“æ¬¡æ¸²æŸ“ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“çš„æ‰€æœ‰å€¼éƒ½å±äºå½“æ¬¡æ¸²æŸ“</h3>
<p><strong>æˆ‘ä»¬çŸ¥é“äº†, å‰¯ä½œç”¨æ–¹æ³•åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹åéƒ½ä¼šæ‰§è¡Œ, ä»æ¦‚å¿µä¸Šå¯ä»¥å°†å‰¯ä½œç”¨æ–¹æ³•ç†è§£ä¸ºç»„ä»¶è¾“å‡ºå†…å®¹çš„ä¸€éƒ¨åˆ†, å¹¶ä¸”å‰¯ä½œç”¨æ–¹æ³•èƒ½å¤Ÿâ€çœ‹åˆ°â€å½“æ¬¡æ¸²æŸ“çš„ props å’Œ state.</strong></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥åšä¸€æ¬¡å®éªŒ. æŸ¥çœ‹ä¸‹é¢çš„ä»£ç :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘åœ¨æ¯æ¬¡å»¶è¿Ÿçš„æ—¶é—´æ®µå†…ç‚¹å‡»å¤šæ¬¡, æœ€ç»ˆè¾“å‡ºçš„å€¼ä¼šæ˜¯æ€æ ·çš„å‘¢?</p>
<hr>
<p><em>å‰§é€</em></p>
<hr>
<p>ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸ªç³Šå¼„ä½ çš„é¢˜ç›®, æœ€ç»ˆçš„ç»“æœä¼šå¾ˆå‡ºäººæ„æ–™. å…¶å®å¹¶ä¸æ˜¯! æˆ‘ä»¬æ¥çœ‹è¿™ä¸€ç³»åˆ—çš„è¾“å‡º â€” æ¯ä¸€ä¸ªè¾“å‡ºéƒ½å±äºç‰¹å®šçš„æ¸²æŸ“, å› æ­¤æ¯ä¸€æ¬¡è¾“å‡ºéƒ½æ˜¯è‡ªå·±çš„ <code class="language-text">count</code> å€¼. å¯ä»¥åœ¨<a href="https://codesandbox.io/s/lyx20m1ol">è¿™é‡Œ</a>è‡ªå·±å°è¯•ä¸€ä¸‹.</p>
<p><img src="/blog/a5727d333c270e05942f508707265378/timeout_counter.gif" alt="timeout_counter"></p>
<p>ä½ å¯èƒ½ä¼šè§‰å¾—: â€œå½“ç„¶æ˜¯è¿™æ ·è¾“å‡ºçš„, å¦åˆ™æ˜¯æ€æ ·çš„å‘¢?â€</p>
<p>ä¸è¿‡, <code class="language-text">this.state</code> åœ¨ç±»ç»„ä»¶ä¸­çš„è¡Œä¸ºå¹¶ä¸æ˜¯è¿™æ ·. å¾ˆå¤šäººä¼šæŠŠ <code class="language-text">useEffect</code> çœ‹ä½œæ˜¯å’Œ<a href="https://codesandbox.io/s/kkymzwjqz3">ç±»ç»„ä»¶æ¦‚å¿µä¸­</a> <code class="language-text">componentDidUpdate</code> å¯¹åº”çš„æ–¹æ³•:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·, <code class="language-text">this.state.count</code> å§‹ç»ˆæ˜¯æœ€æ–°çš„ <code class="language-text">count</code> å€¼, ä½†æ˜¯ <code class="language-text">useEffect</code> ä¸­çš„åˆ™æ˜¯å½“æ¬¡æ¸²æŸ“çš„å€¼, å› æ­¤ä»¥ä¸Šä»£ç çš„ç»“æœ, è¾“å‡ºçš„ä¼šæ˜¯ <code class="language-text">5</code>:</p>
<p><img src="/blog/264b329edc111a1973003bdf2bcacd65/timeout_counter_class.gif" alt="timeout_counter_class"></p>
<p><mark>I think itâ€™s ironic that Hooks rely so much on JavaScript closures, and yet itâ€™s the class implementation that suffers from the canonical wrong-value-in-a-timeout confusion thatâ€™s often associated with closures. This is because the actual source of the confusion in this example is the mutation (React mutates this.state in classes to point to the latest state) and not closures themselves. (æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€çš„æ˜¯, Hooks çš„å®ç°ååˆ†ä¾èµ– JavaScript ä¸­çš„é—­åŒ…)</mark></p>
<p><strong>å½“æˆ‘ä»¬éœ€è¦é”å®šä¸€ä¸ªæ°¸è¿œä¸ä¼šå˜åŒ–çš„å€¼çš„æ—¶å€™, ä½¿ç”¨é—­åŒ…æ˜¯æœ€åˆé€‚çš„æ‰‹æ®µ. è¿™ä½¿å¾—æˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å¤Ÿæ¨å‡ºæ­£ç¡®ç­”æ¡ˆ, å› ä¸ºä½ æ­£åœ¨è¯»å–çš„å€¼å§‹ç»ˆæ˜¯ä¸€ä¸ªå¸¸é‡.</strong> æ—¢ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“äº†å¦‚ä½•ç»´æŒæ¸²æŸ“æ—¶çš„ props å’Œ state, å¯ä»¥å¼€å§‹å°è¯•<a href="https://codesandbox.io/s/w7vjo07055">ä½¿ç”¨é—­åŒ…</a>å¯¹ class ç‰ˆæœ¬çš„ä»£ç è¿›è¡Œæ”¹é€ .</p>
<h3 id="é€†æµè€Œä¸Š" style="position:relative;"><a href="#%E9%80%86%E6%B5%81%E8%80%8C%E4%B8%8A" aria-label="é€†æµè€Œä¸Š permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é€†æµè€Œä¸Š</h3>
<p>æ­¤åˆ»æˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªå…±è¯†: å‡½æ•°å¼ç»„ä»¶åœ¨æ¸²æŸ“æ—¶, å†…éƒ¨çš„æ¯ä¸€é¡¹(åŒ…æ‹¬äº‹ä»¶å¤„ç†å™¨, å‰¯ä½œç”¨æ–¹æ³•, timeout å›è°ƒ, API è°ƒç”¨ç­‰)éƒ½ä¼šâ€æ•æ‰â€æ¸²æŸ“å½“æ—¶çš„ props å’Œ state.</p>
<p>å› æ­¤ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­å…¶å®æ˜¯ä¸€è‡´çš„:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> counter <span class="token operator">=</span> props<span class="token punctuation">.</span>counter</span>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º, ä¸ç®¡æˆ‘ä»¬æ˜¯å¦åœ¨ç»„ä»¶ä¸­æå‰è¯»å–äº† state æˆ–è€… props çš„å€¼, å¯¹å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å–åˆ°çš„ç»“æœéƒ½æ²¡æœ‰å½±å“.</strong> åœ¨å•æ¬¡æ¸²æŸ“çš„ä½œç”¨åŸŸå†…, props å’Œ state å§‹ç»ˆä¼šä¿æŒä¸å˜. (å°† props è§£æ„èƒ½å¤Ÿä½¿å¾—è¿™ä¸ªè¡Œä¸ºæ›´å®¹æ˜“ç†è§£.)</p>
<p>åœ¨æŸäº›åœºæ™¯ä¸‹, æˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›èƒ½å¤Ÿåœ¨å‰¯ä½œç”¨å‡½æ•°çš„å›è°ƒä¸­è¯»å–åˆ°æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ¸²æŸ“å½“æ—¶çš„å€¼. æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code class="language-text">ref</code>, åœ¨è¿™ç¯‡<a href="https://overreacted.io/how-are-function-components-different-from-classes/">æ–‡ç« </a>çš„æœ€åä¸€éƒ¨åˆ†æˆ‘ä»¬æœ‰æåˆ°è¿™ä¸€ç‚¹.</p>
<p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯, å½“æˆ‘ä»¬å¸Œæœ›åœ¨è¿‡å»çš„æ¸²æŸ“ä¸­è¯»å–åˆ°æœªæ¥çš„ props å’Œ state æ—¶, å®é™…ä¸Šåœ¨é€†æµå‰è¿›. è¿™å½“ç„¶æ²¡æœ‰é”™(åœ¨æŸäº›æƒ…å†µä¸‹ç”šè‡³æ˜¯å¿…è¦çš„), ä¸è¿‡è¿™æ ·çš„è¡Œä¸ºçœ‹èµ·æ¥æ¯”è¾ƒâ€ä¸å¹²å‡€â€, è¿èƒŒäº†æ­£å¸¸çš„æ¨¡å¼. ä¸è¿‡å…¶å® React å›¢é˜Ÿæ˜¯åˆ»æ„æŠŠå‡½æ•°å¼ç»„ä»¶çš„è¡Œä¸ºè®¾è®¡æˆè¿™æ ·çš„, è¿™æ ·ä¸€æ¥, ç”¨æˆ·å°±èƒ½å¤Ÿå¾ˆæ˜æ˜¾åœ°å‘ç°ä»£ç ä¸­çš„ç¼ºé™·. åœ¨ç±»å¼ç»„ä»¶ä¸­, å‘ç°è¿™ç±»ç¼ºé™·å°±æ¯”è¾ƒå›°éš¾.</p>
<p>è¿™é‡Œæœ‰<a href="https://codesandbox.io/s/rm7z22qnlp">å¦ä¸€ä¸ªç‰ˆæœ¬è®¡æ—¶å™¨çš„ä¾‹å­</a>, æ¨¡æ‹Ÿäº†åœ¨ç±»å¼ç»„ä»¶çš„å¯¹åº”è¡Œä¸º:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> latestCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// è®¾ç½®å¯å˜çš„æœ€æ–°å€¼</span></span><span class="gatsby-highlight-code-line">    latestCount<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span></span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// è¯»å–å¯å˜çš„æœ€æ–°å€¼</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latestCount<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></div>
<p><img src="/blog/78f7948263dd13b023498b23cb99f4fc/timeout_counter_refs.gif" alt="timeout_counter_refs"></p>
<p>åœ¨ React ä¸­ä¿®æ”¹(mutate)æŸäº›å€¼æˆ–è®¸çœ‹èµ·æ¥å¾ˆå¥‡æ€ª. ä½†æ˜¯å…¶å®åœ¨ç±»å¼ç»„ä»¶ä¸­, React å°±æ˜¯è¿™æ ·ä¸º <code class="language-text">this.state</code> èµ‹å€¼çš„. ä¸è·å–æ¸²æŸ“å½“æ—¶çš„ props å’Œ state ä¸åŒçš„æ˜¯, ç±»å¼ç»„ä»¶è¯»å– <code class="language-text">latestCount.current</code> çš„å€¼, å®ƒè·å–åˆ°çš„ç»“æœæ— æ³•å¾—åˆ°ä»»ä½•çš„ä¿è¯, åœ¨æŸä¸€æ¬¡å›è°ƒä¸­æ˜¯è¿™æ ·çš„ç»“æœ, åˆ°äº†ä¸‹ä¸€æ¬¡æˆ–è®¸åˆä¸ä¸€æ ·äº†, å› ä¸ºå®ƒçš„å€¼æ˜¯å¯å˜çš„. è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸æ„¿æ„å°†è¿™ç§è¡Œä¸ºè®¾ç½®æˆé»˜è®¤è¡Œä¸ºçš„åŸå› .</p>
<h3 id="æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°" style="position:relative;"><a href="#%E6%B8%85%E9%99%A4%E5%89%AF%E4%BD%9C%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0" aria-label="æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•° permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°</h3>
<p><a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup">æ–‡æ¡£ä¸­æåˆ°</a>, æŸäº›å‰¯ä½œç”¨è¿˜éœ€è¦å­˜åœ¨å¯¹åº”çš„æ¸…é™¤å‰¯ä½œç”¨çš„é˜¶æ®µ. æœ¬è´¨ä¸Šæ¥è¯´, åœ¨è¿™ä¸ªé˜¶æ®µä¸­æˆ‘ä»¬åšçš„äº‹æƒ…, å°±æ˜¯æ’¤é”€å‰¯ä½œç”¨(æ¯”å¦‚å–æ¶ˆè®¢é˜…äº‹ä»¶.)</p>
<p>æŸ¥çœ‹ä¸‹é¢çš„ä»£ç :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>å‡å¦‚åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶, <code class="language-text">props</code> çš„å€¼ä¸º <code class="language-text">{id: 10}</code>, ç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶, å€¼ä¸º <code class="language-text">{id: 20}</code>. ä½ æˆ–è®¸ä¼šè®¤ä¸ºæ¸²æŸ“æµç¨‹æ˜¯è¿™æ ·å‘ç”Ÿçš„:</p>
<ul>
<li>React æ¸…é™¤ props ä¸º <code class="language-text">{id: 10}</code> æ—¶çš„å‰¯ä½œç”¨.</li>
<li>React ä¸º <code class="language-text">{id: 20}</code> æ¸²æŸ“å¯¹åº”çš„ UI.</li>
<li>React ä¸º <code class="language-text">{id: 20}</code> æ‰§è¡Œå¯¹åº”çš„å‰¯ä½œç”¨æ–¹æ³•.</li>
</ul>
<p>(ä½†æ˜¯å®é™…æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·çš„.)</p>
<p>å¦‚æœä½ å»ºç«‹äº†ä»¥ä¸Šçš„å¿ƒæ™ºæ¨¡å‹, å°±ä¼šè®¤ä¸ºæ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°â€çœ‹åˆ°äº†â€æ—§çš„ props, å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰æ‰§è¡Œçš„, ç„¶åæ–°çš„å‰¯ä½œç”¨å‡½æ•°â€çœ‹åˆ°äº†â€æ–°çš„ props. è¿™ä¸ªå¿ƒæ™ºæ¨¡å‹å¯¹äºç±»å¼ç»„ä»¶æ¥è¯´, æ˜¯å®Œå…¨æ­£ç¡®çš„, <strong>ä½†æ˜¯å¯¹äºå‡½æ•°å¼ç»„ä»¶, æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·</strong>. æˆ‘ä»¬æ¥çœ‹çœ‹åŸå› æ˜¯ä»€ä¹ˆ.</p>
<p>React æ‰§è¡Œå‰¯ä½œç”¨æ–¹æ³•çš„æ—¶æœºæ˜¯<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f">æµè§ˆå™¨ç»˜åˆ¶éœ€è¦æ¸²æŸ“çš„å†…å®¹ä¹‹å</a>. è¿™æ ·èƒ½å¤Ÿä½¿å¾—æˆ‘ä»¬çš„åº”ç”¨ä½“éªŒæ›´ä½³, ä¸é˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“. æ¸…é™¤å‰¯ä½œç”¨çš„æ–¹æ³•åŒæ—¶ä¹Ÿä¼šå»¶è¿Ÿ. <strong>å‰ä¸€æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨ç›´åˆ°ä½¿ç”¨æ–°çš„ props å¼€å§‹é‡æ–°æ¸²æŸ“, æ‰ä¼šè¢«æ¸…é™¤:</strong></p>
<ul>
<li>React ä¸º <code class="language-text">{id: 20}</code> æ¸²æŸ“å¯¹åº”çš„ UI.</li>
<li>æµè§ˆå™¨ç»˜åˆ¶å†…å®¹, æˆ‘ä»¬çœ‹åˆ° <code class="language-text">{id: 20}</code> å¯¹åº”çš„ UI.</li>
<li>React æ¸…é™¤ props ä¸º <code class="language-text">{id: 10}</code> æ—¶çš„å‰¯ä½œç”¨.</li>
<li>React ä¸º <code class="language-text">{id: 20}</code> æ‰§è¡Œå¯¹åº”çš„å‰¯ä½œç”¨æ–¹æ³•.</li>
</ul>
<p>ä½ æˆ–è®¸ä¼šè§‰å¾—å¥‡æ€ª, ä¸ºä»€ä¹ˆå‰ä¸€æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨æ–¹æ³•è¯»å–åˆ°çš„æ˜¯å‰ä¸€æ¬¡æ¸²æŸ“çš„ props å€¼, è€Œä¸æ˜¯æ­¤åˆ»çš„ <code class="language-text">{id: 20}</code>?</p>
<p>æˆ‘ä»¬ä¹‹å‰å·²ç»æè¿‡è¿™ä¸ªè¯é¢˜â€¦ ğŸ¤”</p>
<p><img src="/blog/5fe238cf03a21dfa32af624124fcdcff/deja_vu.gif" alt="deja_vu"></p>
<p>å…ˆå‰ç« èŠ‚çš„æ‘˜å½•:</p>
<blockquote>
<p>ç»„ä»¶æ¸²æŸ“æ—¶å†…éƒ¨çš„æ¯ä¸€ä¸ªå‡½æ•°(åŒ…æ‹¬äº‹ä»¶å¤„ç†å™¨, å‰¯ä½œç”¨å‡½æ•°, timeout å›è°ƒ, API è°ƒç”¨ç­‰), éƒ½ä¼šâ€æ•æ‰â€å½“æ—¶çš„ props å’Œ state.</p>
</blockquote>
<p>è¿™æ ·ä¸€æ¥, ç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†. æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°æ²¡æœ‰è¯»å–æœ€æ–°çš„ props, å®ƒå§‹ç»ˆä¼šè¯»å–æ¸²æŸ“å½“æ—¶å®šä¹‰çš„ props å’Œ state:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“ props æ˜¯ {id: 10}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// é¦–æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// é¦–æ¬¡æ¸²æŸ“çš„æ¸…é™¤å‰¯ä½œç”¨å‡½æ•°</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span>    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“ props æ˜¯ {id: 20}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
      <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ¸…é™¤å‰¯ä½œç”¨å‡½æ•°</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é¦–æ¬¡æ¸²æŸ“çš„æ¸…é™¤å‡½æ•°, â€œçœ‹åˆ°â€çš„ props ä¸€å®šæ˜¯ <code class="language-text">{id: 10}</code>, ä¸å¯èƒ½æ˜¯å…¶ä»–å€¼.</p>
<p>è¿™ç§å½¢å¼ä½¿å¾— React èƒ½å¤Ÿåœ¨æ‰§è¡Œç»˜åˆ¶ä¹‹åç›´æ¥å¤„ç†å‰¯ä½œç”¨å‡½æ•°, æå‡åº”ç”¨æ€§èƒ½. æ—§çš„ props å§‹ç»ˆå­˜åœ¨, å½“ä»£ç éœ€è¦å®ƒçš„æ—¶å€™, æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬.</p>
<h3 id="åŒæ­¥-è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ" style="position:relative;"><a href="#%E5%90%8C%E6%AD%A5-%E8%80%8C%E4%B8%8D%E6%98%AF%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-label="åŒæ­¥ è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŒæ­¥ è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ</h3>
<p>æˆ‘å–œæ¬¢ React çš„åŸå› ä¹‹ä¸€æ˜¯, å®ƒç»Ÿä¸€æè¿°äº†é¦–æ¬¡æ¸²æŸ“çš„ç»“æœå’Œåç»­çš„æ›´æ–°. è¿™ç§æ¨¡å¼èƒ½å¤Ÿ<a href="https://overreacted.io/the-bug-o-notation/">å‡å°‘ç¨‹åºçš„ç†µ</a>.</p>
<p>ä¸¾ä¸ªä¾‹å­, å¦‚æœæˆ‘çš„ç»„ä»¶æ˜¯ä¸‹é¢è¿™æ ·çš„:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸ç®¡æ˜¯å…ˆæ¸²æŸ“ <code class="language-text">&lt;Greeting name=&quot;Dan&quot; /&gt;</code>, ç„¶åæ¸²æŸ“ <code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>, è¿˜æ˜¯ç›´æ¥æ¸²æŸ“ <code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>. æœ€åçš„ç»“æœéƒ½æ˜¯çœ‹åˆ°å±å¹•ä¸­å‘ˆç°: â€œHello, Yuzhiâ€.</p>
<p>äººä»¬å¸¸è¯´: é‡è¦çš„æ˜¯æ—…ç¨‹è€Œä¸æ˜¯ç›®çš„åœ°. ä½†æ˜¯åœ¨ React ä¸­, æƒ…å†µå°±ä¸æ˜¯è¿™æ ·. <strong>React åªå…³æ³¨ç»“æœ, è€Œéè¿‡ç¨‹.</strong> ä¸¾ä¸ªä¾‹å­, åœ¨ jQuery ä¸­, æˆ‘ä»¬å…³æ³¨è¿‡ç¨‹, æ¯”å¦‚è¯´ä½¿ç”¨ <code class="language-text">$.addClass</code> å’Œ <code class="language-text">$.removeClass</code> æ¥æ“æ§æ ‡ç­¾çš„ <code class="language-text">className</code>, å°±æ˜¯é’ˆå¯¹è¿‡ç¨‹çš„æ“ä½œ, è€Œåœ¨ React ä¸­, æˆ‘ä»¬ä¼šç›´æ¥å£°æ˜ <code class="language-text">className</code> åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„(å…³æ³¨ç»“æœ).</p>
<p><strong>React ä¼šæ ¹æ®å½“å‰çš„ props å’Œ state åŒæ­¥ DOM çš„å†…å®¹.</strong> åœ¨æ¸²æŸ“æ—¶, æŒ‚è½½å’Œæ›´æ–°åšçš„ DOM åŒæ­¥æ“ä½œå…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«.</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„è§’åº¦æ€è€ƒå‰¯ä½œç”¨å‡½æ•°. <strong><code class="language-text">useEffect</code> å‡½æ•°ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ® props å’Œ state åŒæ­¥ React æ ‘ä¹‹å¤–çš„å†…å®¹.</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™æ ·çš„å¿ƒæ™ºæ¨¡å‹å’Œæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ <em>æŒ‚è½½/æ›´æ–°/å¸è½½</em> æœ‰ä¸€ç‚¹åŒºåˆ«. äº†è§£è¿™ä¸ªæ¨¡å‹å¾ˆé‡è¦. <strong>å¦‚æœä½ å®ç°çš„å‰¯ä½œç”¨å‡½æ•°, ä¼šæ ¹æ®æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“, è¿˜æ˜¯åç»­çš„æ¸²æŸ“æœ‰ä¸åŒçš„è¡Œä¸º, é‚£ä¹ˆå°±å’Œæˆ‘ä»¬çš„è®¾è®¡ç†å¿µèƒŒé“è€Œé©°äº†!</strong> å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–çš„æ˜¯â€è¿‡ç¨‹â€è€Œéâ€ç›®çš„åœ°â€, å°±æ˜¯ä¸€æ¬¡å¤±è´¥çš„åŒæ­¥.</p>
<p>ä¸ç®¡æˆ‘ä»¬æ˜¯æŒ‰ç…§å±æ€§(A, B, C)çš„é¡ºåºè¿›è¡Œæ¸²æŸ“, è¿˜æ˜¯ç›´æ¥ç”¨å±æ€§ C è¿›è¡Œæ¸²æŸ“, å…¶å®åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå·®åˆ«. å³ä½¿å­˜åœ¨å·®åˆ«, ä¹Ÿåªæ˜¯æš‚æ—¶æ€§çš„(æ¯”å¦‚æˆ‘ä»¬åœ¨è¯·æ±‚æ•°æ®çš„æ—¶å€™, ä¼šæœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«), ä½†æ˜¯æœ€ç»ˆçš„ç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´çš„.</p>
<p>æœ‰ä¸€ä¸ªæ¯‹åº¸ç½®ç–‘çš„ç‚¹æ˜¯: æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œæ‰€æœ‰çš„å‰¯ä½œç”¨å…¶å®å¾ˆå½±å“æ•ˆç‡. (åœ¨æŸäº›æƒ…å†µä¸‹, ç”šè‡³ä¼šå¯¼è‡´æ— é™å¾ªç¯.)</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆä¿®å¤è¿™ä¸ªé—®é¢˜å‘¢?</p>
<h3 id="å‘Šè¯‰-react-å¦‚ä½•åŒºåˆ«å‰¯ä½œç”¨å‡½æ•°çš„å˜åŒ–" style="position:relative;"><a href="#%E5%91%8A%E8%AF%89-react-%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%AB%E5%89%AF%E4%BD%9C%E7%94%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96" aria-label="å‘Šè¯‰ react å¦‚ä½•åŒºåˆ«å‰¯ä½œç”¨å‡½æ•°çš„å˜åŒ– permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‘Šè¯‰ React å¦‚ä½•åŒºåˆ«å‰¯ä½œç”¨å‡½æ•°çš„å˜åŒ–</h3>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“äº† React å¦‚ä½• diff DOM, React å¹¶æ²¡æœ‰åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™æ›´æ–°æ‰€æœ‰çš„ DOM, è€Œæ˜¯æ›´æ–°æœ‰ä¿®æ”¹çš„éƒ¨åˆ†.</p>
<p>å½“ä½ æ›´æ–°ä»¥ä¸‹ç»„ä»¶</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Hello, Dan</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>ä¸º:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Hello, Yuzhi</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>çš„æ—¶å€™, React çœ‹åˆ°çš„æ˜¯è¿™æ ·ä¸¤ä¸ªå¯¹è±¡:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">"Greeting"</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token string">"Hello, Dan"</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">"Greeting"</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token string">"Hello, Yuzhi"</span> <span class="token punctuation">}</span></code></pre></div>
<p>å¯¹äºä»¥ä¸Šç¤ºä¾‹, React ä¼šæ£€æŸ¥æ¯ä¸€ä¸ª props, ç„¶ååˆ¤æ–­å‡º <code class="language-text">children</code> æœ‰å˜åŒ–, ä¼šå»æ›´æ–° DOM, <code class="language-text">className</code> æ²¡æœ‰å˜åŒ–, å› æ­¤ä¸éœ€è¦æ›´æ–°. æ‰€ä»¥ React åªéœ€è¦è¿™æ ·å¤„ç†å³å¯:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">domNode<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Hello, Yuzhi"</span>
<span class="token comment">// ä¸éœ€è¦å¤„ç† domNode.className</span></code></pre></div>
<p><strong>é‚£ä¹ˆé’ˆå¯¹å‰¯ä½œç”¨å‡½æ•°, æ˜¯å¦ä¹Ÿèƒ½å¤Ÿåªåœ¨å¿…è¦çš„æ—¶å€™æ›´æ–°å‘¢?</strong></p>
<p>ä¸¾ä¸ªä¾‹å­, åœ¨ä»¥ä¸‹å‡½æ•°ä¸­, ç»„ä»¶ä¼šå› ä¸º state çš„æ›´æ–°è€Œé‡æ–°æ¸²æŸ“:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°å¹¶æ²¡æœ‰ç”¨åˆ° <code class="language-text">counter</code> çš„å€¼. <strong>å‰¯ä½œç”¨å‡½æ•°åªä¼šæ ¹æ® <code class="language-text">name</code> çš„å±æ€§å€¼æ›´æ–° <code class="language-text">document.title</code>, ä½†æ˜¯ <code class="language-text">name</code> å±æ€§å€¼å§‹ç»ˆæ˜¯ä¸€è‡´çš„.</strong> å› æ­¤åœ¨æ¯æ¬¡ <code class="language-text">counter</code> å€¼å˜åŒ–çš„æ—¶å€™ç»™ <code class="language-text">document.title</code> é‡æ–°èµ‹å€¼æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„.</p>
<p>é‚£ä¹ˆ React å¦‚ä½•åˆ†è¾¨å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦éœ€è¦å˜åŒ–å‘¢?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, Dan"</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, Dan"</span>
<span class="token punctuation">}</span>
<span class="token comment">// React èƒ½å¤Ÿçœ‹å‡ºè¿™ä¸¤ä¸ªå‡½æ•°åšäº†åŒæ ·çš„äº‹æƒ…å—?</span></code></pre></div>
<p>å¹¶ä¸èƒ½, React åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰, æ˜¯æ— æ³•åˆ†æå‡ºè¿™ä¸ªå‡½æ•°æ‰€åšçš„äº‹æƒ…çš„. æºä»£ç å’Œä¸Šè¿°ä¾‹å­çš„åŒºåˆ«å°±æ˜¯: æºä»£ç å¹¶ä¸åŒ…å«å…·ä½“å€¼, è€Œåªæ˜¯ä¸€ä¸ª <code class="language-text">name</code> å±æ€§.</p>
<p>å› æ­¤, æˆ‘ä»¬è¦é¿å…åœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°, æ–¹å¼æ˜¯ä¼ å…¥ä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•°åˆ° <code class="language-text">useEffect</code> æ–¹æ³•ä¸­, åªæœ‰å½“ä¾èµ–æ•°ç»„ä¸­çš„å€¼å˜åŒ–çš„æ—¶å€™, å‰¯ä½œç”¨å‡½æ•°æ‰ä¼šé‡æ–°æ‰§è¡Œ.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ä¾èµ–æ•°ç»„å‚æ•°</span></span></code></pre></div>
<p><strong>ä»¥ä¸Šçš„åœºæ™¯å°±å¥½åƒæ˜¯æˆ‘ä»¬åœ¨å‘Šè¯‰ React: â€œHey React, æˆ‘çŸ¥é“ä½ ä¸èƒ½çœ‹åˆ°å‡½æ•°å†…éƒ¨çš„å†…å®¹, ä½†æ˜¯æˆ‘å¯ä»¥ç¡®ä¿å‡½æ•°å†…éƒ¨ä½¿ç”¨åˆ°çš„æ¸²æŸ“ç›¸å…³çš„å‚æ•°åªæœ‰ <code class="language-text">name</code>. â€</strong></p>
<p>å¦‚æœå‰ä¸€æ¬¡å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶ <code class="language-text">name</code> çš„å€¼ä¸è¿™ä¸€æ¬¡æ‰§è¡Œæ—¶ä¸€è‡´çš„è¯, é‚£ä¹ˆå°±å¯ä»¥è·³è¿‡æ­¤æ¬¡å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, Dan"</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> oldDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Dan"</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, Dan"</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Dan"</span><span class="token punctuation">]</span>

<span class="token comment">// React æ— æ³•çœ‹åˆ°å‡½æ•°å†…éƒ¨çš„æƒ…å†µ, ä½†æ˜¯å®ƒå¯ä»¥å¯¹æ¯”è¿™äº›ä¾èµ–å‚æ•°</span>
<span class="token comment">// ç”±äºä¾èµ–å‚æ•°çš„å€¼å‰åå§‹ç»ˆä¸€è‡´, å°±ä¸éœ€è¦æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨å‡½æ•°</span></code></pre></div>
<p>å¦‚æœä¾èµ–æ•°ç»„ä¸­çš„æŸä¸ªå€¼åœ¨æ¸²æŸ“å‰åæœ‰æ‰€å·®å¼‚, é‚£ä¹ˆè¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°å°±å¿…é¡»æ‰§è¡Œ. åŒæ­¥æ‰€æœ‰å€¼.</p>
<h3 id="è¦ç¡®ä¿ä¾èµ–æ•°ç»„ä¸­å‚æ•°çš„å‡†ç¡®æ€§-ä¸è¦æ¬ºéª—-react" style="position:relative;"><a href="#%E8%A6%81%E7%A1%AE%E4%BF%9D%E4%BE%9D%E8%B5%96%E6%95%B0%E7%BB%84%E4%B8%AD%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%86%E7%A1%AE%E6%80%A7-%E4%B8%8D%E8%A6%81%E6%AC%BA%E9%AA%97-react" aria-label="è¦ç¡®ä¿ä¾èµ–æ•°ç»„ä¸­å‚æ•°çš„å‡†ç¡®æ€§ ä¸è¦æ¬ºéª— react permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è¦ç¡®ä¿ä¾èµ–æ•°ç»„ä¸­å‚æ•°çš„å‡†ç¡®æ€§ ä¸è¦æ¬ºéª— React</h3>
<p>æ¬ºéª— React å…³äºä¾èµ–æ•°ç»„ä¸­çš„å†…å®¹ä¼šå¸¦æ¥æ¯”è¾ƒä¸å¥½çš„åæœ. <mark>Intuitively, this makes sense, but Iâ€™ve seen pretty much everyone who tries useEffect with a mental model from classes try to cheat the rules. (And I did that too at first!)</mark></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//  è¿™æ ·çš„å†™æ³•æ˜¯åˆç†çš„å—? åœ¨æŸäº›åœºæ™¯ä¸‹ä¸åˆç†, æˆ‘ä»¬å¯ä»¥æœ‰æ›´å¥½çš„æ–¹å¼æ¥ç¼–å†™è¿™éƒ¨åˆ†ä»£ç </span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(å…³äº <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies">Hooks çš„å¸¸è§é—®é¢˜</a>ä¸­, å·²ç»è¯¦ç»†è¯´æ˜äº†æ›´åˆé€‚çš„åšæ³•. æˆ‘ä»¬å›åˆ°ç°åœ¨çš„ä¾‹å­:)</em></p>
<p>ä½ æˆ–è®¸ä¼šè¿™æ ·è¯´: â€œä½†æ˜¯æˆ‘åªå¸Œæœ›åœ¨ç»„ä»¶æŒ‚è½½çš„æ—¶å€™æ‰§è¡Œè¿™ä¸ªæ–¹æ³•!â€œ. æˆ‘ä»¬è¦è®°ä½è¿™æ ·ä¸€ä¸ªåŸåˆ™: å¦‚æœä½ å£°æ˜äº†ä¾èµ–å‚æ•°, <strong>æ‰€æœ‰ç»„ä»¶å†…éƒ¨çš„å€¼, åªè¦è¢«å‰¯ä½œç”¨å‡½æ•°ä½¿ç”¨, å°±ä¸€å®šè¦æ·»åŠ åˆ°ä¾èµ–å‚æ•°æ•°ç»„ä¸­.</strong> åŒ…æ‹¬ props, state, å‡½æ•°ç­‰ä»»ä½•åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨çš„å€¼.</p>
<p>ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜. æ¯”å¦‚å¾ªç¯è¯·æ±‚çš„æƒ…å†µ, æˆ–è€…æ˜¯æŸä¸ª socket ä¸æ–­è¢«é‡æ–°åˆ›å»ºçš„æƒ…å†µ. <strong>é’ˆå¯¹è¿™äº›é—®é¢˜çš„å¤„ç†æ–¹å¼å¹¶ä¸æ˜¯åˆ é™¤è¿™ä¸ªä¾èµ–.</strong> åé¢æˆ‘ä»¬ä¼šè°ˆåˆ°å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜.</p>
<p>åœ¨æˆ‘ä»¬æŸ¥çœ‹è§£å†³æ–¹æ¡ˆä¹‹å‰, å…ˆæ·±å…¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬çš„é—®é¢˜.</p>
<h3 id="å½“ä½ å¯¹-react-æ’’è°-ä¼ å…¥äº†é”™è¯¯çš„ä¾èµ–å‚æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ" style="position:relative;"><a href="#%E5%BD%93%E4%BD%A0%E5%AF%B9-react-%E6%92%92%E8%B0%8E-%E4%BC%A0%E5%85%A5%E4%BA%86%E9%94%99%E8%AF%AF%E7%9A%84%E4%BE%9D%E8%B5%96%E5%8F%82%E6%95%B0%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88" aria-label="å½“ä½ å¯¹ react æ’’è° ä¼ å…¥äº†é”™è¯¯çš„ä¾èµ–å‚æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å½“ä½ å¯¹ React æ’’è° ä¼ å…¥äº†é”™è¯¯çš„ä¾èµ–å‚æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ</h3>
<p>å¦‚æœä¾èµ–æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°ä¼šç”¨åˆ°çš„å€¼, React å°±èƒ½å¤ŸçŸ¥é“ä½•æ—¶éœ€è¦é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span></span></code></pre></div>
<p><img src="/blog/fae247cd068eedbd4b62ba50592d2b3d/deps-compare-correct.gif"></p>
<p><em>(ä¾èµ–æ•°ç»„ä¸­çš„å€¼åœ¨æ¸²æŸ“å‰åæœ‰æ‰€å·®å¼‚, å› æ­¤æˆ‘ä»¬éœ€è¦é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°.)</em></p>
<p>å¦‚æœæˆ‘ä»¬åœ¨ä¾èµ–æ•°ç»„ä¸­ä¼ å…¥ç©ºæ•°ç»„<code class="language-text">[]</code>, æ–°çš„å‰¯ä½œç”¨å‡½æ•°å°±ä¸ä¼šè¢«é‡æ–°æ‰§è¡Œ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ç¼ºå°‘äº† name å‚æ•°</span></span></code></pre></div>
<p><img src="/blog/25f75db3f9f57ffe1426912093577445/deps-compare-wrong.gif"></p>
<p><em>(ä¾èµ–æ•°ç»„å‰åä¸€è‡´, å› æ­¤è·³è¿‡è¿™æ¬¡å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œ)</em></p>
<p>é€šè¿‡ä»¥ä¸Šçš„åœºæ™¯å¯¹æ¯”, é—®é¢˜å°±å¾ˆæ˜æ˜¾åœ°ä½“ç°å‡ºæ¥äº†. <mark>But the intuition can fool you in other cases where a class solution â€œjumps outâ€ from your memory.</mark></p>
<p>ä¸¾ä¸ªä¾‹å­, æ¯”å¦‚æˆ‘ä»¬æƒ³è¦å®ç°ä¸€ä¸ªè®¡æ•°å™¨, æ¯éš”ä¸€ç§’æ•°å­—åŠ  1. å¦‚æœæ˜¯ç±»å¼ç»„ä»¶çš„è¯, æˆ‘ä»¬ä¼šè¿™æ ·å®ç°å®ƒ: åœ¨ç»„ä»¶æŒ‚è½½çš„æ—¶å€™è®¾ç½®è®¡æ—¶å™¨å‡½æ•°, ç»„ä»¶å¸è½½çš„æ—¶å€™æ¸…é™¤.</p>
<p>è¿™æ˜¯å…·ä½“çš„<a href="https://codesandbox.io/s/n5mjzjy9kl">ä»£ç ç¤ºä¾‹</a>. å½“æˆ‘ä»¬æƒ³è¦æŠŠç±»å¼ç»„ä»¶è½¬æ¢æˆå‡½æ•°å¼ç»„ä»¶çš„æ—¶å€™, ä¼šä¹ æƒ¯æ€§åœ°ä½¿ç”¨ <code class="language-text">useEffect</code>, è®¾ç½®ä¾èµ–å‚æ•°ä¸º <code class="language-text">[]</code>, è¡¨ç¤ºå¸Œæœ›å‰¯ä½œç”¨å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯çœŸæ­£æ‰§è¡Œäº†ä¼šå‘ç°, ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„é‚£æ ·. <a href="https://codesandbox.io/s/91n5z8jo7r">ç¤ºä¾‹ä»£ç </a>.</p>
<p>å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯è¿™æ ·çš„: â€œä¾èµ–çš„ä½œç”¨æ˜¯è®©æˆ‘å£°æ˜ä»€ä¹ˆæ—¶å€™éœ€è¦é‡æ–°è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œâ€, é‚£ä¹ˆä½ å†™å‡ºæ¥çš„ä»£ç å°±ä¼šå¾ˆå±é™©, å°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·. ä½†æ˜¯é—®é¢˜æ˜¯, ä½ å¸Œæœ›åªè§¦å‘ä¸€æ¬¡å‰¯ä½œç”¨æ–¹æ³•, å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé—´éš”æ‰§è¡Œçš„ API, å®é™…ä¸Šå¹¶æ²¡æœ‰é”™, ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šå¸¦æ¥é—®é¢˜å‘¢?</p>
<p>ä¹‹å‰å·²ç»æåˆ°è¿‡, å‰¯ä½œç”¨å‡½æ•°ä¸­ä½¿ç”¨åˆ°çš„<em>æ‰€æœ‰</em>å€¼, æˆ‘ä»¬éƒ½è¦åœ¨ä¾èµ–å‚æ•°æ•°ç»„ä¸­å£°æ˜. ç”±äºå†…éƒ¨ä½¿ç”¨åˆ°äº† <code class="language-text">count</code>, ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ä¾èµ–å‚æ•°æ•°ç»„ä¸­å£°æ˜, å¼•èµ· bug åªæ˜¯æ—¶é—´çš„é—®é¢˜.</p>
<p>åœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™, <code class="language-text">count</code> çš„å€¼æ˜¯ <code class="language-text">0</code>. <code class="language-text">setCount(count + 1)</code> åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶å®é™…æ‰§è¡Œçš„æ˜¯ <code class="language-text">setCount(0 + 1)</code>. <strong>ä½†æ˜¯å› ä¸ºæˆ‘ä»¬å£°æ˜çš„ä¾èµ–æ•°ç»„å‚æ•°ä¸­æ•°ç»„å€¼ä¸º <code class="language-text">[]</code>, å› æ­¤å‰¯ä½œç”¨å‡½æ•°ä¸ä¼šå˜åŒ–, æ¯éš”ä¸€ç§’æ‰§è¡Œçš„å‡½æ•°éƒ½æ˜¯ <code class="language-text">setCount(0 + 1)</code></strong>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“, state æ˜¯ 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// é¦–æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// å§‹ç»ˆæ˜¯ setCount(1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// å§‹ç»ˆä¸ä¼šé‡æ–°æ‰§è¡Œ</span></span>  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸‹ä¸€æ¬¡æ¸²æŸ“, state æ˜¯ 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// å‰¯ä½œç”¨å‡½æ•°è¢«å¿½ç•¥äº†, å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–å‚æ•°ä¼ é€’é”™è¯¯.</span></span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç”±äºåœ¨ä¾èµ–å‚æ•°ä¸­ä¼ é€’äº†ä¸€ä¸ªç©ºæ•°ç»„, è¡¨æ˜äº†æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°ä¸ä¾èµ–ä»»ä½•å€¼. ä½†æ˜¯å®é™…ä¸Šå‰¯ä½œç”¨å‡½æ•°ä¸­å­˜åœ¨ä¾èµ–å…¶ä»–å€¼çš„éƒ¨åˆ†.</p>
<p>æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°ä½¿ç”¨åˆ°äº† <code class="language-text">count</code>, è¿™ä¸ªå€¼å£°æ˜äºç»„ä»¶ä¹‹å†…, å‰¯ä½œç”¨å‡½æ•°ä¹‹å¤–:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>å› æ­¤, å°†ä¾èµ–å‚æ•°è®¾ç½®ä¸º <code class="language-text">[]</code> ä¼šå¼•èµ· bug. React ä¼šå¯¹æ¯”ä¾èµ–é¡¹æ•°ç»„ä¸­çš„å†…å®¹, ç„¶åè·³è¿‡å‰¯ä½œç”¨å‡½æ•°çš„æ›´æ–°:</p>
<p><img src="/blog/29e53bd0c9b7d2ac70d3cd924886b030/interval-wrong.gif"></p>
<p><em>(ä¾èµ–é¡¹ä¸­çš„å†…å®¹å§‹ç»ˆæ²¡æœ‰åŒºåˆ«, å› æ­¤è·³è¿‡å‰¯ä½œç”¨å‡½æ•°çš„æ›´æ–°)</em></p>
<p>è¿™æ ·çš„é—®é¢˜æ¯”è¾ƒéš¾å®šä½. å› æ­¤, æˆ‘å»ºè®®å¤§å®¶åœ¨ä¼ é€’ä¾èµ–é¡¹å‚æ•°çš„æ—¶å€™å¯¹ React ä¿æŒè¯šå®, å£°æ˜æ‰€æœ‰ä¾èµ–å‚æ•°. (æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <a href="https://github.com/facebook/react/issues/14920">lint è§„åˆ™æ’ä»¶</a> ä»¥ä¾›ç”¨æˆ·åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨.)</p>
<h3 id="ä¸¤ç§å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼" style="position:relative;"><a href="#%E4%B8%A4%E7%A7%8D%E5%AF%B9%E4%BE%9D%E8%B5%96%E9%A1%B9%E4%BF%9D%E6%8C%81%E8%AF%9A%E5%AE%9E%E7%9A%84%E6%96%B9%E5%BC%8F" aria-label="ä¸¤ç§å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸¤ç§å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼</h3>
<p>å¯¹ä¾èµ–é¡¹ä¿æŒè¯šå®çš„æ–¹å¼æœ‰ä¸¤ç§, æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼, åœ¨å¿…è¦æƒ…å†µä¸‹ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼.</p>
<p><strong>ç¬¬ä¸€ç§æ–¹å¼æ˜¯åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­å£°æ˜å‰¯ä½œç”¨å‡½æ•°çš„æ‰€æœ‰ä¾èµ–</strong>, é’ˆå¯¹ä»¥ä¸Šçš„ä»£ç , æˆ‘ä»¬åŠ ä¸Š <code class="language-text">count</code> ä½œä¸ºä¾èµ–é¡¹:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>è¿™æ ·ä¸€æ¥, ä¾èµ–é¡¹æ•°ç»„çš„å£°æ˜å°±æ˜¯æ­£ç¡®çš„. è¿™å¹¶ä¸æ˜¯ <em>ç†æƒ³</em> çš„è§£å†³æ–¹æ¡ˆ, ä½†æ˜¯è‡³å°‘è§£å†³äº†é—®é¢˜. ç°åœ¨åªè¦ <code class="language-text">count</code> å‘ç”Ÿå˜åŒ–, å‰¯ä½œç”¨å‡½æ•°å°±ä¼šé‡æ–°æ‰§è¡Œ, å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å– <code class="language-text">count</code> å€¼çš„éƒ¨åˆ†(<code class="language-text">setCount(count + 1)</code>)ä¹Ÿä¼šå¯¹åº”åœ°å‘ç”Ÿå˜åŒ–:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// é¦–æ¬¡æ¸²æŸ“, state å€¼ä¸º 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// é¦–æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“, state å€¼ä¸º 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶çš„å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™æ ·ä¿®æ”¹ä¹‹å, <a href="https://codesandbox.io/s/0x0mnlyq8l">é—®é¢˜è§£å†³äº†</a>, ä½†æ˜¯åªè¦ <code class="language-text">count</code> ä¸€å‘ç”Ÿå˜åŒ–, æˆ‘ä»¬çš„é—´éš”å‡½æ•°ä¼šä¸æ–­è¢«é”€æ¯é‡å»º. è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„è¡Œä¸º:</p>
<p><img src="/blog/5734271ddfa94d2d65ac6160515e0069/interval-rightish.gif"></p>
<p><em>(ä¾èµ–é¡¹å˜åŒ–äº†, å› æ­¤æˆ‘ä»¬é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°.)</em></p>
<hr>
<p><strong>ç¬¬äºŒç§æ–¹å¼æ˜¯æ”¹å˜å‰¯ä½œç”¨å‡½æ•°æœ¬èº«, ä½¿å¾—å®ƒä¸ä¾èµ–å¤–éƒ¨ç»å¸¸ä¼šå˜åŒ–çš„å€¼.</strong> æˆ‘ä»¬ä¸æƒ³è¦æ¬ºéª— React å…³äºä¾èµ–é¡¹çš„å†…å®¹, äºæ˜¯å°½å¯èƒ½å¾—å‡å°‘ä¾èµ–é¡¹çš„å†…å®¹.</p>
<p>ç°åœ¨æˆ‘ä»¬å¼€å§‹çœ‹çœ‹å‡å°‘ä¾èµ–é¡¹çš„å¸¸ç”¨æ–¹æ³•.</p>
<hr>
<h3 id="ç”¨å‡½æ•°çš„æ–¹å¼æ›´æ–°çŠ¶æ€" style="position:relative;"><a href="#%E7%94%A8%E5%87%BD%E6%95%B0%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81" aria-label="ç”¨å‡½æ•°çš„æ–¹å¼æ›´æ–°çŠ¶æ€ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç”¨å‡½æ•°çš„æ–¹å¼æ›´æ–°çŠ¶æ€</h3>
<p>ç°åœ¨æˆ‘ä»¬çš„è¯‰æ±‚æ˜¯å°† <code class="language-text">count</code> ä¾èµ–ä»å‰¯ä½œç”¨æ–¹æ³•çš„ä¾èµ–ä¸­ç§»é™¤.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>ä¸ºäº†è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„, é¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜, <strong><code class="language-text">count</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢?</strong> çœ‹èµ·æ¥åªæœ‰åœ¨ <code class="language-text">setCount</code> å‡½æ•°ä¸­æ‰ä¼šç”¨åˆ°å®ƒ. è¿™æ ·åˆ†æä¸‹æ¥å‘ç°, æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°å†…å…¶å®å¯ä»¥ä¸ä¾èµ– <code class="language-text">count</code>. å½“æˆ‘ä»¬éœ€è¦åŸºäºå‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°å½“å‰çŠ¶æ€çš„æ—¶å€™, å¯ä»¥ç”¨ <code class="language-text">setState</code> çš„<a href="https://reactjs.org/docs/hooks-reference.html#functional-updates">å‡½æ•°æ›´æ–°çš„æ–¹å¼</a>æ›´æ–°çŠ¶æ€.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>æˆ‘å€¾å‘äºå°†è¿™äº›æƒ…å†µçœ‹ä½œæ˜¯â€é”™è¯¯çš„ä¾èµ–â€. å¦‚æœæˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°çš„å†…å®¹æ˜¯ <code class="language-text">setCount(count + 1)</code>, é‚£ä¹ˆ <code class="language-text">count</code> å°±æ˜¯ä¸€ä¸ªå¿…è¦çš„ä¾èµ–é¡¹. å†ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°, æˆ‘ä»¬å…¶å®åªä¾èµ– <code class="language-text">count</code> çš„å€¼ç”¨æ¥è®¡ç®— <code class="language-text">count + 1</code>, ç„¶åå°†è®¡ç®—å¾—å‡ºçš„å€¼æŠ›ç»™ React. ä¸è¿‡, React å…¶å®æ—©å·²çŸ¥é“å½“å‰çš„ <code class="language-text">count</code> å€¼. <strong>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰ React , å¦‚ä½•æ›´æ–°(+1) <code class="language-text">count</code> å€¼, å°±å¯ä»¥äº†, ä¸ç®¡å½“å‰çš„ <code class="language-text">count</code> å€¼æ˜¯å¤šå°‘, React éƒ½èƒ½å¤Ÿæ­£ç¡®è®¡ç®—æœ€ç»ˆçš„ç»“æœ.</strong></p>
<p>å…¶å®, <code class="language-text">setCount(c =&gt; c + 1)</code> åšçš„å°±æ˜¯è¿™ä»¶äº‹æƒ…. ä½ å¯ä»¥è®¤ä¸ºå®ƒä¼ é€’äº†ä¸€ä¸ªæŒ‡ä»¤ç»™ React, å‘Šè¯‰ React åº”è¯¥å¦‚ä½•æ›´æ–°çŠ¶æ€çš„å€¼. è¿™ç§æ›´æ–°çŠ¶æ€çš„å½¢å¼åœ¨ä¸€äº›å…¶ä»–åœºæ™¯ä¸‹åŒæ ·èƒ½å¤Ÿå‘æŒ¥å¾ˆå¤§çš„ç”¨å¤„, æ¯”å¦‚å½“æˆ‘ä»¬éœ€è¦<a href="https://overreacted.io/react-as-a-ui-runtime/#batching">åˆå¹¶çŠ¶æ€çš„æ›´æ–°</a>çš„æ—¶å€™.</p>
<p><strong>æ³¨æ„, æ­¤æ—¶æˆ‘ä»¬å°†ä¾èµ–ä»ä¾èµ–æ•°ç»„ä¸­åˆ é™¤, æ˜¯çœŸæ­£ä¸éœ€è¦è¿™ä¸ªä¾èµ–äº†, å¹¶æ²¡æœ‰æ¬ºéª— React, æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°ç¡®å®ä¸å†éœ€è¦è¯»å– <code class="language-text">count</code> çš„å€¼äº†.</strong></p>
<p><img src="/blog/f128ad20c28317ed27a3cb68197fc906/interval-right.gif"></p>
<p><em>(ä¾èµ–é¡¹å‰åä¸€è‡´, å› æ­¤æˆ‘ä»¬è·³è¿‡å‰¯ä½œç”¨æ–¹æ³•çš„æ‰§è¡Œ)</em></p>
<p>å¯ä»¥åœ¨è¿™é‡Œ<a href="https://codesandbox.io/s/q3181xz1pj">è¯•ä¸€è¯•</a>.</p>
<p>å°½ç®¡å‰¯ä½œç”¨å‡½æ•°åªæ‰§è¡Œäº†ä¸€æ¬¡, å±äºç¬¬ä¸€æ¬¡æ¸²æŸ“ interval å›è°ƒå‡½æ•°ä¾ç„¶åœ¨æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™, å®Œç¾åœ°å°† <code class="language-text">c =&gt; c + 1</code> çš„æ›´æ–°æŒ‡ä»¤ä¼ è¾¾ç»™äº† React . å‰¯ä½œç”¨å‡½æ•°ä¸å†ä¾èµ–å½“å‰çš„ <code class="language-text">count</code> å€¼, å› ä¸º React å·²ç»çŸ¥é“å®ƒçš„å€¼äº†.</p>
<h3 id="å‡½æ•°å¼æ›´æ–°ä¸-google-docs" style="position:relative;"><a href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%9B%B4%E6%96%B0%E4%B8%8E-google-docs" aria-label="å‡½æ•°å¼æ›´æ–°ä¸ google docs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‡½æ•°å¼æ›´æ–°ä¸ Google Docs</h3>
<p>è¿˜è®°å¾—æˆ‘ä»¬æåˆ°çš„, å‰¯ä½œç”¨çš„å¿ƒæ™ºæ¨¡å‹ä¸åŒæ­¥æœ‰å…³å—? å…³äºåŒæ­¥å¾ˆæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯, æˆ‘ä»¬é€šå¸¸å¸Œæœ›è§£è€¦ç³»ç»Ÿå’Œç³»ç»Ÿå†…éƒ¨çŠ¶æ€ä¹‹é—´çš„é€šä¿¡. ä¸¾ä¸ªä¾‹å­, å½“æˆ‘ä»¬åœ¨ Google Docs ä¸Šç¼–è¾‘ä¸€ä»½æ–‡æ¡£æ—¶, å¹¶æ²¡æœ‰å°†æ•´ä¸ªé¡µé¢å†…å®¹ä¼ ç»™æœåŠ¡å™¨, å› ä¸ºè¿™æ ·å°†ä¼šååˆ†ä½æ•ˆ. å–è€Œä»£ä¹‹ä¼ é€’çš„æ˜¯ç”¨æˆ·è¦åšçš„åŠ¨ä½œ.</p>
<p>å½“ç„¶æˆ‘ä»¬çš„åœºæ™¯å’Œ Google Docs å¹¶ä¸å®Œå…¨ç›¸åŒ, <strong>ä¸è¿‡è¿™ç§å“²å­¦åœ¨ effect ä¸­åŒæ ·é€‚ç”¨. åªä¼ é€’å°½å¯èƒ½å°‘çš„å¿…éœ€çš„ä¿¡æ¯åˆ°ç»„ä»¶ä¸­.</strong> æ›´æ–°çŠ¶æ€çš„å‡½æ•°å½¢å¼ <code class="language-text">setCount(c =&gt; c + 1)</code> æ¯”èµ· <code class="language-text">setCount(count + 1)</code> è¡¨è¾¾äº†æ›´å°‘çš„ä¿¡æ¯. å› ä¸º <code class="language-text">setCount</code> ä¾èµ–äºå½“å‰ <code class="language-text">count</code> çš„å€¼. è¦æŠŠ React å†™å¥½, æˆ‘ä»¬åº”è¯¥ç§‰æ‰¿è¿™æ ·ä¸€ä¸ªç†å¿µ: é€‰æ‹©å°½å¯èƒ½ç®€å•çš„ state å½¢å¼æ¥è¡¨è¾¾ UI. è¿™ç§ç†å¿µåœ¨çŠ¶æ€çš„æ›´æ–°ä¸­åŒæ ·é€‚ç”¨.</p>
<p>å¯¹ <em>æ„å›¾</em> (è€Œä¸æ˜¯ç»“æœ)è¿›è¡Œç¼–ç , ä¸ Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682">è§£å†³ååŒç¼–è¾‘</a>çš„æ–¹æ¡ˆå¾ˆç›¸ä¼¼. åœ¨ React ä¸­ç”¨å‡½æ•°å½¢å¼æ›´æ–°çŠ¶æ€ä¹Ÿæ˜¯ç±»ä¼¼çš„å®è·µ. è¿™æ ·çš„æ–¹å¼ç¡®ä¿äº†, å³ä½¿æ›´æ–°æ¥è‡ªäºå¤šä¸ªæ¥æº(äº‹ä»¶å¤„ç†å™¨, å‰¯ä½œç”¨å‡½æ•°è®¢é˜…ç­‰), ä¹Ÿèƒ½å¤Ÿåœ¨ä¸€æ¬¡æ‰¹é‡æ“ä½œä¸­æ­£ç¡®åœ°æ‰§è¡Œ, å¹¶ä¸”èƒ½å¤Ÿé¢„æµ‹æ›´æ–°çš„ç»“æœ.</p>
<p><strong>ä¸è¿‡, <code class="language-text">setCount(c =&gt; c + 1)</code> çš„æ›´æ–°æ–¹å¼å¹¶ä¸æ˜¯ç‰¹åˆ«å®Œç¾.</strong> å› ä¸ºè¿™ç§å½¢å¼çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ª, å¹¶ä¸”åœ¨æŸç§ç¨‹åº¦ä¸Šé™åˆ¶äº†æˆ‘ä»¬çš„èƒ½åŠ›. æ¯”å¦‚è¯´, å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡, ä¸”ä¸¤è€…äº’ç›¸ä¾èµ–, æˆ–è€…æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡å±æ€§è®¡ç®—ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„çŠ¶æ€å€¼æ—¶, å°±æ²¡åŠæ³•ä½¿ç”¨å‡½æ•°å¼çš„æ›´æ–°æ–¹å¼. ä¸è¿‡å¹¸è¿çš„æ˜¯, æˆ‘ä»¬è¿˜æœ‰ <code class="language-text">useReducer</code>, å®ƒçš„æ›´æ–°æ–¹å¼ä¸å‡½æ•°å¼çš„æ›´æ–°æ–¹å¼ç±»ä¼¼, ä½†æ˜¯åŠŸèƒ½æ›´åŠ å¼ºå¤§.</p>
<h3 id="å°†çŠ¶æ€æ›´æ–°ä»-actions-ä¸­è§£è€¦" style="position:relative;"><a href="#%E5%B0%86%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0%E4%BB%8E-actions-%E4%B8%AD%E8%A7%A3%E8%80%A6" aria-label="å°†çŠ¶æ€æ›´æ–°ä» actions ä¸­è§£è€¦ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å°†çŠ¶æ€æ›´æ–°ä» actions ä¸­è§£è€¦</h3>
<p>ç°åœ¨ä¿®æ”¹ä»¥ä¸Šçš„ç¤ºä¾‹, æ”¹ä¸ºå­˜åœ¨ä¸¤ä¸ªçŠ¶æ€ç›¸å…³çš„å˜é‡: <code class="language-text">count</code> å’Œ <code class="language-text">step</code>. æˆ‘ä»¬çš„é—´éš”æ‰§è¡Œå‡½æ•°ä¸æ˜¯æ¯ç§’åŠ  1, è€Œæ˜¯æ¯ç§’åŠ ä¸Š <code class="language-text">step</code> å˜é‡æ‰€æŒ‡çš„å€¼:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>step<span class="token punctuation">,</span> setStep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> step<span class="token punctuation">)</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>step<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setStep</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/zxn70rnkx">ä»£ç ç¤ºä¾‹</a>)</p>
<p>æ­¤åˆ»æˆ‘ä»¬<strong>å¹¶æ²¡æœ‰æ¬ºéª—</strong> React. å› ä¸ºåœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­ä½¿ç”¨äº† <code class="language-text">step</code> , æˆ‘ä»¬åœ¨ä¾èµ–å‚æ•°ä¸­ä¹ŸåŠ ä¸Šäº†å®ƒ, å› æ­¤å‡½æ•°æ‰§è¡Œçš„ç»“æœå§‹ç»ˆæ˜¯å‡†ç¡®çš„.</p>
<p>å¯¹äºä¸Šè¿°çš„ä¾‹å­, å¯ä»¥è¿™æ ·æè¿°å®ƒçš„è¡Œä¸º, ä¸€æ—¦ <code class="language-text">step</code> çš„å€¼å‘ç”Ÿå˜åŒ–, å°±é‡æ–°å¼€å§‹æ‰§è¡Œè¿™ä¸ªé—´éš” (interval) å‡½æ•°(å› ä¸º <code class="language-text">step</code> å­˜åœ¨äºä¾èµ–å‚æ•°æ•°ç»„ä¸­). å¤§å¤šæ•°æƒ…å†µä¸‹, è¿™å°±æ˜¯æˆ‘ä»¬æœŸå¾…çš„ç»“æœ: é”€æ¯å‰¯ä½œç”¨å‡½æ•°å¹¶åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å‰¯ä½œç”¨å‡½æ•°. è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„æ¨¡å¼, æ­£å¸¸æƒ…å†µä¸‹, å®ƒä¹Ÿæ˜¯å”¯ä¸€å¯ä»¥é€‰æ‹©çš„æ›´æ–°æ–¹å¼.</p>
<p>ä¸è¿‡, å¦‚æœæˆ‘ä»¬æœŸå¾…çš„ç»“æœæ˜¯è¿™æ ·çš„, å¯èƒ½å°±æ²¡åŠæ³•é‡‡å–ä»¥ä¸Šæ¨¡å¼äº†: æˆ‘ä»¬ä¸å¸Œæœ› <code class="language-text">step</code> å˜åŒ–å¼•èµ·å‰¯ä½œç”¨å‡½æ•°çš„é”€æ¯å’Œé‡æ–°åˆ›å»º, é‚£ä¹ˆåº”è¯¥æ€ä¹ˆæ ·æ‰èƒ½æŠŠ <code class="language-text">step</code> ä»å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–æ•°ç»„ä¸­åˆ é™¤å‘¢?</p>
<p><strong>å½“æˆ‘ä»¬é‡åˆ°è¿™æ ·çš„åœºæ™¯: state ä¸­çš„æŸä¸ªå€¼ä¾èµ– state ä¸­çš„å¦ä¸€ä¸ªå€¼, å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code class="language-text">useReducer</code> æ¥è¾¾åˆ°æ›´æ–°çŠ¶æ€çš„ç›®çš„.</strong></p>
<p>å½“ä½ å‘ç°ä½ å†™çš„è®¾ç½®çŠ¶æ€ç›¸å…³çš„ä»£ç å˜æˆå¦‚ä¸‹è¿™æ ·çš„æ—¶å€™: <code class="language-text">setSomething(something =&gt; ...)</code>, å°±å¯ä»¥å¼€å§‹è€ƒè™‘ä½¿ç”¨ reducer äº†. reducer èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°†ç»„ä»¶å†…éƒ¨è¡¨è¾¾ actions çš„é€»è¾‘å’ŒçŠ¶æ€æ›´æ–°çš„é€»è¾‘è¿›è¡Œè§£è€¦. </p>
<p>ç°åœ¨ç”¨ <code class="language-text">dispatch</code> ä¾èµ–æ¥æ›¿æ¢ä»£ç ä¸­çš„ <code class="language-text">step</code> ä¾èµ–:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span></span><span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"tick"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Instead of setCount(c => c + step);</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span></span></code></pre></div>
<p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/xzr480k0np">ä»£ç ç¤ºä¾‹</a>)</p>
<p>ä½ æˆ–è®¸ä¼šç–‘æƒ‘: â€œè¿™æ ·çš„æ–¹å¼ä¸ºä»€ä¹ˆæ›´å¥½å‘¢?â€ å› ä¸º <strong>React ä¼šç¡®ä¿ <code class="language-text">dispatch</code> å‡½æ•°åœ¨ç»„ä»¶è¢«åˆ›å»ºä¹‹å, åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé—´, å§‹ç»ˆæ˜¯ä¸€ä¸ªå¸¸é‡. å› æ­¤åœ¨ä»¥ä¸Šçš„ç¤ºä¾‹ä¸­, ä¸éœ€è¦å†é‡æ–°è®¢é˜… interval å‡½æ•°.</strong></p>
<p>è‡³æ­¤, å·²ç»è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜!</p>
<p><em>(ä½ æˆ–è®¸ä¼šåœ¨ä¾èµ–æ•°ç»„ä¸­çœå» <code class="language-text">dispatch</code>, <code class="language-text">setState</code>, æˆ–è€… <code class="language-text">useRef</code> è¿™äº›å‡½æ•°, å› ä¸ºå®ƒä»¬å§‹ç»ˆä¸ä¼šå˜åŒ–, ç¡®å®æ˜¯è¿™æ ·, æ˜¯å¦å°†å®ƒä»¬å†™å…¥ä¾èµ–æ•°ç»„ä¸­éƒ½æ— æ‰€è°“.)</em></p>
<p><code class="language-text">dispatch</code> å‡½æ•°åšçš„äº‹æƒ…, å¹¶ä¸æ˜¯è¯»å–å‰¯ä½œç”¨å‡½æ•°å†…éƒ¨çš„ state, è€Œæ˜¯åˆ†å‘ä¸€ä¸ª action, æè¿°<em>å‘ç”Ÿäº†ä»€ä¹ˆ</em>. è¿™æ ·çš„æ–¹å¼ä½¿å¾—å‰¯ä½œç”¨å‡½æ•°èƒ½å¤Ÿå’Œ <code class="language-text">step</code> çŠ¶æ€è§£è€¦. æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°å…¶å®å¹¶ä¸åœ¨æ„æˆ‘ä»¬å¦‚ä½•æ›´æ–°çŠ¶æ€. å®ƒåªæ˜¯å•çº¯åœ°å‘Šè¯‰æˆ‘ä»¬<em>å‘ç”Ÿäº†ä»€ä¹ˆ</em>. reducer å‡½æ•°, åˆ™åªå…³æ³¨çŠ¶æ€æ›´æ–°çš„é€»è¾‘:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  step<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"tick"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> count <span class="token operator">+</span> step<span class="token punctuation">,</span> step <span class="token punctuation">}</span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"step"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step<span class="token operator">:</span> action<span class="token punctuation">.</span>step <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/xzr480k0np">ä»£ç ç¤ºä¾‹</a>.</p>
<h3 id="ä¸ºä»€ä¹ˆ-usereducer-æ˜¯-hooks-çš„æ¬ºéª—æ¨¡å¼" style="position:relative;"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-usereducer-%E6%98%AF-hooks-%E7%9A%84%E6%AC%BA%E9%AA%97%E6%A8%A1%E5%BC%8F" aria-label="ä¸ºä»€ä¹ˆ usereducer æ˜¯ hooks çš„æ¬ºéª—æ¨¡å¼ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„æ¬ºéª—æ¨¡å¼</h3>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“, å½“å‰¯ä½œç”¨å‡½æ•°ä¸­çŠ¶æ€çš„æ›´æ–°ä¾èµ–å‰ä¸€æ¬¡æ¸²æŸ“æ—¶çš„çŠ¶æ€å€¼, æˆ–è€…å¦ä¸€ä¸ªçŠ¶æ€å€¼çš„æ—¶å€™, åº”è¯¥é€šè¿‡ä»€ä¹ˆæ–¹å¼ç§»é™¤å‡½æ•°çš„ä¾èµ–é¡¹. <strong>é‚£ä¹ˆå½“æˆ‘ä»¬ä¾èµ–å±æ€§ <em>props</em> çš„æ—¶å€™, åº”è¯¥æ€ä¹ˆå¤„ç†å‘¢?</strong> ä¸¾ä¸ªä¾‹å­, å½“æˆ‘ä»¬çš„ API æ˜¯ <code class="language-text">&lt;Counter step={1}&gt;</code>. æ­¤æ—¶, æˆ‘ä»¬æ˜¯å¦å¿…é¡»è¦åœ¨ä¾èµ–æ•°ç»„ä¸­å£°æ˜ <code class="language-text">props.step</code> å‘¢?</p>
<p>æœ‰ä¸å¿…å£°æ˜çš„æ–¹æ³•! å¯ä»¥å°† reducer å‡½æ•°<em>æœ¬èº«</em>ç½®äºæˆ‘ä»¬çš„ç»„ä»¶å†…éƒ¨, è¿™æ · reducer å°±èƒ½å¤Ÿç›´æ¥è¯»å–å¯¹åº”çš„ props:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> step <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"tick"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> state <span class="token operator">+</span> step</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"tick"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯è¿™ç§æ¨¡å¼æœ‰ä¸ªé—®é¢˜, é‡‡å–è¿™ç§æ¨¡å¼ä¹‹å, æˆ‘ä»¬å°±æ— æ³•è¿›è¡Œä¸€äº›å¿…è¦çš„ä¼˜åŒ–. æ¯”è¾ƒå¥½çš„ä¸€ç‚¹æ˜¯, åœ¨å¿…è¦æƒ…å†µä¸‹, reducer å‡½æ•°ä¸­èƒ½å¤Ÿä»»æ„è¯»å–æ‰€éœ€çš„ props. (è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/7ypm405o8q">ä»£ç ç¤ºä¾‹</a>.)</p>
<p><strong>å³ä½¿æ˜¯åœ¨è¿™æ ·çš„æƒ…å†µä¸‹, æˆ‘ä»¬çš„ <code class="language-text">dispatch</code> å‡½æ•°ä¾ç„¶èƒ½å¤Ÿä¿è¯åœ¨ç»„ä»¶å¤šæ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å§‹ç»ˆä¿æŒä¸å˜.</strong> å› æ­¤åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­å¿½ç•¥è¿™ä¸ªå‡½æ•°æ˜¯å®Œå…¨åˆç†çš„, å®ƒä¸ä¼šå¼•èµ·å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ.</p>
<p>ä½ æˆ–è®¸ä¼šå¯¹è¿™ç§æ¨¡å¼çš„åº•å±‚åŸç†æ„Ÿåˆ°å¥½å¥‡. å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ä¸­ä½¿ç”¨ reducer çš„æ—¶å€™, å®ƒæ˜¯æ€ä¹ˆâ€çŸ¥é“â€å¦ä¸€æ¬¡æ¸²æŸ“æ—¶çš„ props çš„å‘¢? è¿™æ˜¯å› ä¸ºå½“ä½ è°ƒç”¨ <code class="language-text">dispatch</code> çš„æ—¶å€™, React ä¼šè®°ä½è¿™ä¸ª action, ç„¶ååœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ <em>è°ƒç”¨</em> reducer. æ­¤æ—¶, æœ€æ–°çš„ props å°±å¤„äºæ¸²æŸ“çš„ä½œç”¨åŸŸä¸­äº†, <mark>and you wonâ€™t be inside an effect. </mark></p>
<p><strong>è¿™ä¹Ÿæ˜¯æˆ‘å€¾å‘äºå°† <code class="language-text">useReducer</code> çœ‹ä½œ Hooks çš„â€æ¬ºéª—æ¨¡å¼â€çš„åŸå› . ä½¿ç”¨ <code class="language-text">useReducer</code>, æˆ‘ä»¬èƒ½å¤Ÿå°†çŠ¶æ€æ›´æ–°çš„é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆçš„é€»è¾‘è¿›è¡Œè§£è€¦. åŒæ—¶å¸®åŠ©æˆ‘ä»¬åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­åˆ é™¤ä¸å¿…è¦çš„ä¾èµ–, é¿å…ä¸å¿…è¦çš„å‰¯ä½œç”¨é‡æ–°æ‰§è¡Œ, ä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½.</strong></p>
<h3 id="å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å†…éƒ¨" style="position:relative;"><a href="#%E5%B0%86%E5%87%BD%E6%95%B0%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%89%AF%E4%BD%9C%E7%94%A8%E5%86%85%E9%83%A8" aria-label="å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å†…éƒ¨ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å†…éƒ¨</h3>
<p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„è¯¯åŒºæ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æ˜¯å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–, å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·. ä¸¾ä¸ªä¾‹å­:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hits<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>
      <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™æ ·æ˜¯å¯ä»¥çš„å—</span></span>
  <span class="token comment">// ...</span></code></pre></div>
<p>(<a href="https://codesandbox.io/s/8j4ykjyv0">ä»£ç ç¤ºä¾‹</a> æ¥è‡ªäº <em>Robin Wieruch</em> çš„<a href="https://www.robinwieruch.de/react-hooks-fetch-data">æ–‡ç« </a>)</p>
<p>ä»£ç å®é™…ä¸Šæ˜¯æœ‰ä½œç”¨çš„. <strong>ä½†é—®é¢˜æ˜¯, ç®€å•åœ°çœç•¥å†…éƒ¨å‡½æ•°ä¾èµ–, å½“ç»„ä»¶çš„è§„æ¨¡å˜å¤§ä¹‹å, æˆ‘ä»¬ä¼šå¾ˆéš¾å‘ç°ä»£ç æ˜¯å¦è¦†ç›–äº†æ‰€æœ‰æƒ…å†µ.</strong></p>
<p>å‡è®¾æˆ‘ä»¬çš„ä»£ç å˜æˆå¦‚ä¸‹è¿™æ ·, æ¯ä¸€ä¸ªå‡½æ•°å˜ä¸ºåŸæ¥çš„äº”å€è§„æ¨¡:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å‡è®¾è¿™æ˜¯ä¸ªå¾ˆé•¿çš„å‡½æ•°</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query=react"</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å‡è®¾è¿™ä¹Ÿæ˜¯ä¸ªå¾ˆé•¿çš„å‡½æ•°</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åæˆ‘ä»¬åœ¨è¿™äº›å‡½æ•°ä¸­ä½¿ç”¨ä¸€äº› state æˆ– props:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>

  <span class="token comment">// å‡è®¾è¿™æ˜¯ä¸ªå¾ˆé•¿çš„å‡½æ•°</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query</span>  <span class="token punctuation">}</span>

  <span class="token comment">// å‡è®¾è¿™ä¹Ÿæ˜¯ä¸ªå¾ˆé•¿çš„å‡½æ•°</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä»¬å¿˜äº†æ›´æ–°æ•°ç»„çš„ä¾èµ–é¡¹, é—æ¼äº†æŸäº›æ–¹æ³•çš„è¯, å‰¯ä½œç”¨å‡½æ•°å°±å¾ˆå¯èƒ½æ— æ³•å‡†ç¡®åŒæ­¥ props å’Œ state ä¸­çš„æŸäº›å€¼. å¼•èµ·ä¸€äº› bug.</p>
<p>ä¸è¿‡å¹¸è¿çš„æ˜¯, æœ‰ä¸ªç®€å•çš„è§£å†³åŠæ³•. <strong>å¦‚æœæˆ‘ä»¬åªåœ¨å‰¯ä½œç”¨å‡½æ•°å†…ç”¨åˆ°ç›¸å…³çš„å‡½æ•°, å¯ä»¥ç›´æ¥å°†å‡½æ•°ç§»åˆ°å‰¯ä½œç”¨å‡½æ•°å†…éƒ¨:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// ç§»åŠ¨åˆ°å‰¯ä½œç”¨å‡½æ•°å†…éƒ¨</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query=react"</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… ä¾èµ–å£°æ˜æ­£ç¡®</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(è¿™é‡Œæ˜¯ä»£ç <a href="https://codesandbox.io/s/04kp3jwwql">ç¤ºä¾‹</a>)</p>
<p>è¿™æ ·çš„æ–¹å¼æœ‰ä»€ä¹ˆå¥½å¤„å‘¢? æˆ‘ä»¬ä¸å†éœ€è¦è€ƒè™‘ <mark> â€œtransitive dependenciesâ€ </mark>. ä¾èµ–å‚æ•°æ•°ç»„ä¹Ÿä¸ä¼šå†æ¬ºéª— React: <strong>å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä»»ä½•å‰¯ä½œç”¨å‡½æ•°å¤–éƒ¨çš„å€¼.</strong></p>
<p>å¦‚æœåç»­æ›´æ–° <code class="language-text">getFetchUrl</code> æ–¹æ³•: å†…éƒ¨ä½¿ç”¨ <code class="language-text">state</code> ä¸­çš„ <code class="language-text">query</code> å€¼, å°±ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ­£åœ¨ç¼–è¾‘å‰¯ä½œç”¨å‡½æ•°<em>å†…éƒ¨</em>çš„å†…å®¹ä¾èµ–ä¸€ä¸ªå¤–éƒ¨çš„å€¼ â€” å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ä¾èµ–å‚æ•°ä¸­æ·»åŠ  <code class="language-text">query</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query</span>    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… ä¾èµ–é¡¹å‡†ç¡®</span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(ä»£ç <a href="https://codesandbox.io/s/pwm32zx7z7">ç¤ºä¾‹</a>)</p>
<p>æ·»åŠ è¿™é¡¹ä¾èµ–çš„è¡Œä¸º, å¹¶ä¸æ˜¯å•çº¯å®‰æŠš React è€Œå·², è¿™æ ·ä¿®æ”¹ä¹‹å, å½“ <code class="language-text">query</code> å˜åŒ–çš„æƒ…å†µä¸‹, åº”ç”¨å°±ä¼šé‡æ–°è¯·æ±‚æ•°æ®. <strong><code class="language-text">useEffect</code> çš„è®¾è®¡å¼ºåˆ¶è¦æ±‚å¼€å‘è€…å…³æ³¨åº”ç”¨ä¸­æ•°æ®æµçš„å˜åŒ–æƒ…å†µ, å¹¶æ®æ­¤é€‰æ‹©æˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°åº”è¯¥å¦‚ä½•æ ¹æ®å˜åŒ–åšå‡ºå¯¹åº”çš„åŒæ­¥, è€Œä¸æ˜¯å¿½ç•¥æ•°æ®æµçš„å˜åŒ–, ç­‰åˆ°ç”¨æˆ·å‘ç° bug ä¹‹åæ‰å¼€å§‹å…³æ³¨ç›¸å…³çš„é€»è¾‘.</strong></p>
<p>å¼€å‘è€…åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ <code class="language-text">eslint-plugin-react-hooks</code> æ’ä»¶, å¹¶å¼€å¯å¯¹åº”çš„ä»£ç è§„èŒƒæç¤ºè§„åˆ™: <code class="language-text">exhaustive-deps</code>, è¿™ä¸ªæ’ä»¶ä¼š<a href="https://github.com/facebook/react/issues/14920">åˆ†æä»£ç ä¸­çš„å‰¯ä½œç”¨å‡½æ•°</a>, å¦‚æœå‰¯ä½œç”¨å‡½æ•°çš„å®ç°å­˜åœ¨ç¼ºé™·, æ’ä»¶å°±ä¼šæŠ›å‡ºå¯¹åº”çš„æç¤º. ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªå·¥å…·ä¼šåœ¨æˆ‘ä»¬çš„ç»„ä»¶æ²¡æœ‰æ­£ç¡®å¤„ç†æ•°æ®æµçš„æƒ…å†µä¸‹ç»™æˆ‘ä»¬æç¤º.</p>
<p><img src="/blog/04a90dcbacb01105d634964880ebed19/exhaustive-deps.gif"></p>
<h3 id="æ— æ³•å°†å‡½æ•°ç§»å…¥å‰¯ä½œç”¨å†…éƒ¨çš„æƒ…å†µ" style="position:relative;"><a href="#%E6%97%A0%E6%B3%95%E5%B0%86%E5%87%BD%E6%95%B0%E7%A7%BB%E5%85%A5%E5%89%AF%E4%BD%9C%E7%94%A8%E5%86%85%E9%83%A8%E7%9A%84%E6%83%85%E5%86%B5" aria-label="æ— æ³•å°†å‡½æ•°ç§»å…¥å‰¯ä½œç”¨å†…éƒ¨çš„æƒ…å†µ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ— æ³•å°†å‡½æ•°ç§»å…¥å‰¯ä½œç”¨å†…éƒ¨çš„æƒ…å†µ</h3>
<p>åœ¨æŸäº›æƒ…å†µä¸‹, æˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›å°†å‡½æ•°ç§»åŠ¨åˆ°å‰¯ä½œç”¨å‡½æ•°<em>å†…éƒ¨</em>. æ¯”å¦‚è¯´, åœ¨å¤šä¸ªå‰¯ä½œç”¨å‡½æ•°ä¸­éƒ½ç”¨åˆ°äº†åŒä¸€ä¸ªæ–¹æ³•, æ­¤æ—¶æˆ‘ä»¬ä¸å¸Œæœ›æ‹·è´ç²˜è´´ä¸€äº›é‡å¤çš„é€»è¾‘. åˆæˆ–è€…, è¿™ä¸ªå‡½æ•°æ˜¯é€šè¿‡ props ä¼ ä¸‹æ¥çš„.</p>
<p>è¿™æ—¶æˆ‘ä»¬è¦åœ¨ä¾èµ–å‚æ•°æ•°ç»„ä¸­å¿½ç•¥è¿™ä¸ªå‡½æ•°å—? å½“ç„¶ä¸. å†é‡ç”³ä¸€æ¬¡, <strong>å‰¯ä½œç”¨å‡½æ•°å¯¹äºä¾èµ–é¡¹çš„å£°æ˜, ä¸€å®šè¦ä¿æŒè¯šå®.</strong> æˆ‘ä»¬æ€»æ˜¯èƒ½å¤Ÿæ‰¾åˆ°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆçš„. ä¸€ä¸ªæ™®éå­˜åœ¨çš„è¯¯è§£æ˜¯: â€œå‡½æ•°å§‹ç»ˆä¸ä¼šå˜åŒ–â€. ä½†æ˜¯è¿™ç¯‡æ–‡ç« é˜…è¯»ä¸‹æ¥ä¹‹åæˆ‘ä»¬ä¼šå‘ç°, äº‹å®å¹¶ä¸æ˜¯è¿™æ ·. çœŸå®æƒ…å†µæ˜¯, å®šä¹‰åœ¨ç»„ä»¶å†…éƒ¨çš„å‡½æ•°åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“è¿‡ç¨‹ä¸­éƒ½ä¼šæœ‰å˜åŒ–.</p>
<p><strong>è¿™ç§ç°è±¡ä¹Ÿæ­ç¤ºäº†ä¸€ä¸ªé—®é¢˜.</strong> å¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªå‰¯ä½œç”¨å‡½æ•°, è°ƒç”¨äº† <code class="language-text">getFetchUrl:</code></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ğŸ”´ ç¼ºå°‘äº†ä¾èµ– getFetchUrl</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"redux"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ğŸ”´ ç¼ºå°‘äº†ä¾èµ– getFetchUrl</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­, æˆ‘ä»¬ä¸ä¼šå°† <code class="language-text">getFetchUrl</code> æ–¹æ³•ç§»åŠ¨åˆ°å‰¯ä½œç”¨å‡½æ•°çš„å†…éƒ¨, å› ä¸ºå¦‚æœè¿™æ ·çš„è¯, å‰¯ä½œç”¨å‡½æ•°å°±æ— æ³•å…±äº« <code class="language-text">getFetchUrl</code> æ–¹æ³•.</p>
<p>å¦ä¸€æ–¹é¢, å› ä¸ºæˆ‘ä»¬è¦å¯¹ä¾èµ–é¡¹æ•°ç»„å§‹ç»ˆä¿æŒè¯šå®, å°±ä¼šé‡åˆ°å¦ä¸€ä¸ªé—®é¢˜. ç”±äºæˆ‘ä»¬çš„ä¸¤ä¸ªå‰¯ä½œç”¨å‡½æ•°éƒ½ä¾èµ– <code class="language-text">getFetchUrl</code> (<strong>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰æ‰€å·®å¼‚</strong>), å¦‚æœä¼ é€’äº† <code class="language-text">getFetchUrl</code>, ä¾èµ–é¡¹æ•°ç»„å°±åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆç”¨äº†: å› ä¸ºæ¯æ¬¡æ¸²æŸ“, å‰¯ä½œç”¨å‡½æ•°éƒ½ä¼šé‡æ–°æ‰§è¡Œ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è§¦å‘æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œ</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ğŸš§ å‚æ•°ä¾èµ–å‡†ç¡®, ä½†æ˜¯æ”¹å˜å¾—å¤ªé¢‘ç¹äº†</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"redux"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ğŸš§ å‚æ•°ä¾èµ–å‡†ç¡®, ä½†æ˜¯æ”¹å˜å¾—å¤ªé¢‘ç¹äº†</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥è€ƒè™‘åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­ç›´æ¥çœç•¥ <code class="language-text">getFetchUrl</code>. ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆ, å½“æˆ‘ä»¬è¦ä¿®æ”¹ç»„ä»¶ä¸­çš„æ•°æ®æµçš„æ—¶å€™, å¦‚æœå‰¯ä½œç”¨å‡½æ•°æ¶ˆè´¹äº†ç›¸å…³æ•°æ®, å°±ä¼šå¼•èµ·ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜. æ¯”å¦‚æˆ‘ä»¬å…ˆå‰ç¢°åˆ°çš„, é—´éš”(interval)å‡½æ•°ä¸æ›´æ–°çš„ bug.</p>
<p>å…¶å®è¿˜æœ‰å…¶ä»–æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆ.</p>
<p><strong>ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæ˜¯, å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰æ¶ˆè´¹ç»„ä»¶ä½œç”¨åŸŸå†…çš„å€¼, å¯ä»¥å°†å‡½æ•°ç§»åˆ°ç»„ä»¶å¤–éƒ¨, ç”±äºç§»åˆ°å¤–éƒ¨çš„å‡½æ•°ä¸ä¼šå› ä¸ºæ¸²æŸ“äº§ç”Ÿå˜åŒ–, æˆ‘ä»¬å°±ä¸å¿…åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­å£°æ˜è¿™ä¸ªå‡½æ•°:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token comment">// âœ… ä¸ä¼šè¢«æ•°æ®æµå½±å“</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query</span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… ä¾èµ–å‚æ•°å£°æ˜å‡†ç¡®</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"redux"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… ä¾èµ–å‚æ•°å£°æ˜å‡†ç¡®</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">getFetchUrl</code> å¹¶ä¸å­˜åœ¨äºæ¸²æŸ“é˜¶æ®µçš„ä½œç”¨åŸŸä¸­, ä¹Ÿä¸ä¼šè¢«ç»„ä»¶æ•°æ®æµçš„å˜åŒ–å½±å“, æˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦åœ¨ä¾èµ–å‚æ•°ä¸­å£°æ˜å®ƒ: è¿™ä¸ªå‡½æ•°ä¸å¯èƒ½å› ä¸º props æˆ–è€… state çš„å˜åŒ–è€Œäº§ç”Ÿå˜åŒ–.</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯, å°†å‡½æ•°ç”¨ <a href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code class="language-text">useCallback</code> Hook</a> åŒ…è£¹èµ·æ¥:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… ç¼“å­˜ getFetchUrl</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">query</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… Callback çš„ä¾èµ–å‚æ•°å‡†ç¡®</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… Effect çš„ä¾èµ–å‚æ•°å‡†ç¡®</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">"redux"</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… Effect çš„ä¾èµ–å‚æ•°å‡†ç¡®</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">useCallback</code> æ‰€åšçš„äº‹æƒ…, å°±åƒæ˜¯ç»™ä¾èµ–å‚æ•°æ£€æŸ¥åŠ äº†å¦ä¸€å±‚å±éšœ. ä»å¦ä¸€ä¸ªè§’åº¦å…¥æ‰‹è§£å†³äº†æˆ‘ä»¬ç›®å‰éœ€è¦è§£å†³çš„é—®é¢˜ â€” <strong>ä¸ä¿®æ”¹ä¾èµ–å‚æ•°çš„å£°æ˜, è€Œæ˜¯é’ˆå¯¹æ‰€ä¾èµ–çš„å€¼æœ¬èº«åšæ–‡ç« , ç¡®ä¿å®ƒåªåœ¨å¿…è¦çš„æ—¶å€™å‘ç”Ÿå˜åŒ–.</strong></p>
<p>ä¸ºä»€ä¹ˆè¿™æ ·çš„æ–¹å¼æ˜¯æœ‰ç”¨çš„å‘¢. ä¹‹å‰çš„ä¸¤ä¸ªä¾‹å­ä¸­å±•ç¤ºäº†é’ˆå¯¹ <code class="language-text">&#39;react&#39;</code> å’Œ <code class="language-text">&#39;redux&#39;</code> çš„ä¸¤ä¸ªæœç´¢ç»“æœ. å¦‚æœæˆ‘ä»¬ç°åœ¨å¸Œæœ›åŠ å…¥ä¸€ä¸ªè¾“å…¥æ¡†, ä»¥ä¾›ç”¨æˆ·è¾“å…¥ä»»æ„çš„ <code class="language-text">query</code> å‚æ•°æ‰§è¡Œæœç´¢. è¿™æ ·ä¸€æ¥, <code class="language-text">getFetchUrl</code> å°±éœ€è¦ä»ç»„ä»¶å†…éƒ¨çš„ä½œç”¨åŸŸ state ä¸­è¯»å–ä¸€äº›å€¼.</p>
<p>æ­¤æ—¶ä¾èµ–å‚æ•°çš„æ•°ç»„ä¸­, å°±åº”è¯¥åŠ ä¸Š <code class="language-text">query</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸å­˜åœ¨ query å‚æ•°</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ğŸ”´ é—æ¼äº†ä¾èµ–é¡¹: query</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä¿®æ”¹ <code class="language-text">useCallback</code> ä¾èµ–é¡¹æ•°ç»„, æ·»åŠ  <code class="language-text">query</code>, å½“ <code class="language-text">query</code> å˜åŒ–çš„æ—¶å€™, ä»»ä½•ä½¿ç”¨åˆ° <code class="language-text">getFetchUrl</code> çš„å‰¯ä½œç”¨å‡½æ•°éƒ½ä¼šé‡æ–°æ‰§è¡Œ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>

  <span class="token comment">// âœ… ç¼“å­˜ getFetchUrl æ–¹æ³•, åªæœ‰ query å˜åŒ–çš„æ—¶å€™ getFetchUrl æ‰ä¼šå˜åŒ–</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
    $$
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… Callback çš„ä¾èµ–å‚æ•°å‡†ç¡®</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åæ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ… å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–å‚æ•°å‡†ç¡®</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å› ä¸ºä½¿ç”¨äº† <code class="language-text">useCallback</code>, å¦‚æœ <code class="language-text">query</code> å‚æ•°å§‹ç»ˆä¿æŒä¸å˜çš„è¯, <code class="language-text">getFetchUrl</code> ä¹Ÿå°±ä¸ä¼šæœ‰å˜åŒ–, é‚£ä¹ˆå‰¯ä½œç”¨å‡½æ•°ä¹Ÿå°±ä¸ä¼šé‡æ–°æ‰§è¡Œ. å¦‚æœ <code class="language-text">query</code> å˜åŒ–äº†, <code class="language-text">getFetchUrl</code> ä¹Ÿä¼šåŒæ—¶å‘ç”Ÿå˜åŒ–, ç„¶åé‡æ–°è¯·æ±‚æ•°æ®. è¿™å°±å¥½åƒæ˜¯å½“æˆ‘ä»¬ä¿®æ”¹ Excel ä¸­çš„æŸä¸ªå•å…ƒæ ¼ä¹‹å, å…¶ä»–å•å…ƒæ ¼ä¸­çš„æ•°æ®å¦‚æœä¾èµ–è¿™ä¸ªå•å…ƒæ ¼çš„æ•°æ®, å°±ä¼šæ ¹æ®æ–°çš„æ•°æ®é‡æ–°è®¡ç®—å¯¹åº”çš„ç»“æœ.</p>
<p>æ‹¥æŠ±äº†æ•°æ®æµå’ŒåŒæ­¥çš„å¿ƒæ™ºæ¨¡å‹ä¹‹å, å°±è‡ªç„¶ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœ. <strong>åŒæ ·çš„è§£å†³æ–¹å¼å¯¹äºå‡½æ•°ç»„ä»¶çš„ props ä¹Ÿä¸€æ ·æœ‰æ•ˆ:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"react"</span><span class="token punctuation">)</span>

  <span class="token comment">// âœ… ç›´åˆ° query å˜åŒ–çš„æ—¶å€™, fetchData æ‰ä¼šå˜åŒ–</span>
  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> query
    <span class="token comment">// ... è¯»å–æ•°æ®ç„¶åè¿”å›ç›¸åº”çš„æ•°æ® ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ…  ä¾èµ–é¡¹å‡†ç¡®</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// âœ…  ä¾èµ–é¡¹å‡†ç¡®</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç”±äº <code class="language-text">fetchData</code> å­˜åœ¨äº <code class="language-text">Parent</code> ç»„ä»¶å†…éƒ¨, åŒæ—¶åªæœ‰å½“ <code class="language-text">query</code> å˜åŒ–çš„æ—¶å€™, <code class="language-text">fetchData</code> æ‰ä¼šå˜åŒ–, å› æ­¤æˆ‘ä»¬çš„ <code class="language-text">Child</code> ç»„ä»¶, åªæœ‰åœ¨éœ€è¦çš„æ—¶æœºæ‰ä¼šé‡æ–°è·å–æ•°æ®.</p>
<h3 id="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—" style="position:relative;"><a href="#%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E5%90%97" aria-label="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å— permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—</h3>
<p>å¾ˆæœ‰æ„æ€çš„æ˜¯, è¿™ç§æ¨¡å¼åœ¨ç±»å¼ç»„ä»¶ä¸‹å°±å®Œå…¨ä¸é€‚ç”¨äº†, è¿™ä¹Ÿä»å¦ä¸€æ–¹é¢ä½“ç°å‡ºäº†å‰¯ä½œç”¨å‡½æ•°çš„å¿ƒæ™ºæ¨¡å‹å’Œç”Ÿå‘½å‘¨æœŸæ¨¡å¼å­˜åœ¨å·®å¼‚. æŸ¥çœ‹ä¸‹é¢çš„å¯¹åº”ç±»ç»„ä»¶ä»£ç :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token operator">:</span> <span class="token string">"react"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query</span><span class="gatsby-highlight-code-line">    <span class="token comment">// ... è¯·æ±‚æ•°æ®å¹¶ä¸”æ‰§è¡Œä¸€äº›å…¶ä»–æ“ä½œ ...</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½ æˆ–è®¸ä¼šæƒ³: â€œæˆ‘ä»¬éƒ½å·²ç»çŸ¥é“: <code class="language-text">useEffect</code> å°±åƒæ˜¯ <code class="language-text">componentDidMount</code> å’Œ <code class="language-text">componentDidUpdate</code> çš„ç»“åˆä½“, ä¸éœ€è¦æ—¶æ—¶åˆ»åˆ»é‡ç”³è¿™ä¸ªè§‚ç‚¹!â€ <strong>ä½†æ˜¯å®é™…ä¸Š, è¿™ä¸ªè§‚ç‚¹æ˜¯é”™çš„, <code class="language-text">useEffect</code> æ— æ³•å®Œå…¨æ¨¡æ‹Ÿ <code class="language-text">componentDidUpdate</code> çš„è¡Œä¸º</strong>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// ğŸ”´ è¿™ç§æƒ…å†µæ°¸è¿œä¸ä¼šå‘ç”Ÿ</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fetchData <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>fetchData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å½“ç„¶äº†, <code class="language-text">fetchData</code> æ˜¯ä¸€ä¸ªç±»æ–¹æ³•!(ä¹Ÿå¯ä»¥è¯´æ˜¯ç±»çš„å±æ€§ â€” ä½†æ˜¯è¿™å¹¶ä¸èƒ½æ”¹å˜ä»€ä¹ˆ.) å³ä½¿ state äº§ç”Ÿå˜åŒ–, è¿™ä¸ªç±»æ–¹æ³•ä¹Ÿä¸ä¼šéšä¹‹å˜åŒ–. å› æ­¤ <code class="language-text">this.props.fetchData</code> çš„å€¼å§‹ç»ˆä¸ <code class="language-text">prevProps.fetchData</code> çš„å€¼ä¸€è‡´, å› æ­¤ä»¥ä¸Šä»£ç ä¸­çš„æƒ…å†µæ°¸è¿œä¸ä¼šå‘ç”Ÿ. é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ç§»é™¤è¿™ä¸ªæ¡ä»¶åˆ¤æ–­å—? å°†ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹è¿™æ ·:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"> <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>å¹¶ä¸å¯ä»¥, å¦‚æœæˆ‘ä»¬è¿™æ ·ä¿®æ”¹ä»£ç çš„è¯, æ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“éƒ½ä¼šé‡æ–°è¯·æ±‚æ•°æ®. (åœ¨ç»„ä»¶æ ‘ä¸­æ·»åŠ ä¸€äº›åŠ¨ç”»èƒ½å¤Ÿæ›´ç›´è§‚åœ°è§‚å¯Ÿåˆ°è¿™ä¸ªå˜åŒ–.) é‚£ä¹ˆå¦‚æœå°† <code class="language-text">fetchData</code> ç»‘å®šåˆ°ç‰¹å®šçš„ query ä¸­, ä¼šæ€ä¹ˆæ ·å‘¢?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>è¿™æ ·ä¿®æ”¹ä¹‹å, å³ä½¿ <code class="language-text">query</code> æ²¡æœ‰å˜åŒ–, <code class="language-text">this.props.fetchData !== prevProps.fetchData</code> çš„å€¼ä¹Ÿå§‹ç»ˆæ˜¯ <code class="language-text">true</code>. å› æ­¤å§‹ç»ˆä¼šé‡æ–°è¯·æ±‚æ•°æ®.</p>
<p>å¯¹äºè¿™ä¸ªé—®é¢˜, å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆæ˜¯å°† <code class="language-text">query</code> å‚æ•°æœ¬èº«ä¼ é€’åˆ° <code class="language-text">Child</code> ç»„ä»¶ä¸­. <code class="language-text">Child</code> ç»„ä»¶å®é™…ä¸Šå¹¶ä¸ä¼šä½¿ç”¨ <code class="language-text">query</code> å‚æ•°, ä½†æ˜¯åœ¨ <code class="language-text">query</code> å˜åŒ–çš„æ—¶å€™,  <code class="language-text">Child</code> ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ä»¥å‘èµ·æ•°æ®çš„é‡æ–°è¯·æ±‚:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token operator">:</span> <span class="token string">"react"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://hn.algolia.com/api/v1/search?query="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query
    <span class="token comment">// ... è¯·æ±‚æ•°æ®ç„¶åè¿›è¡Œä¸€äº›å…¶ä»–æ“ä½œ...</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token attr-name">query</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¾ˆé•¿ä¸€æ®µæ—¶é—´, æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ React ç±»ç»„ä»¶, æˆ‘å¾ˆä¹ æƒ¯å°†ä¸€äº›ä¸å¿…è¦çš„ props ä¼ é€’åˆ°ç»„ä»¶ä¸­, ä¹ æƒ¯ç ´åçˆ¶ç»„ä»¶çš„å°è£…. ç›´åˆ°ä¸€å‘¨å‰æˆ‘æ‰çŸ¥é“, ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»è¦è¿™æ ·åš.</p>
<p><strong>åœ¨ç±»ç»„ä»¶çš„åœºæ™¯ä¸‹, å‡½æ•°çš„ props æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†.</strong> ç»„ä»¶çš„æ–¹æ³•åŒ…è£¹äº†å¯å˜çš„ <code class="language-text">this</code>, å› æ­¤æˆ‘ä»¬ä¸èƒ½å¤Ÿå¤ªè¿‡ä¾èµ–æ–¹æ³•çš„ç­¾å. æ‰€ä»¥, å³ä½¿æˆ‘ä»¬éœ€è¦çš„åªæ˜¯ä¸€ä¸ªå‡½æ•°, ä¹Ÿå¾—åŒæ—¶ä¼ é€’ä¸€äº›å…¶ä»–æ•°æ®, è¿™æ · React æ‰èƒ½å¤Ÿæ–¹ä¾¿åœ°è¿›è¡Œ â€œdiffâ€ çš„æ“ä½œ. åŒæ—¶, æˆ‘ä»¬æ— æ³•çŸ¥é“ä»çˆ¶ç»„ä»¶ä¸­ä¼ é€’ä¸‹æ¥çš„ <code class="language-text">this.props.fetchData</code> æœ¬èº«æ˜¯å¦ä¾èµ–äºæŸä¸ª state å€¼, è¿™ä¸ª state å€¼æ˜¯å¦å˜åŒ–è¿‡.</p>
<p><strong>ä½¿ç”¨ <code class="language-text">useCallback</code> ä¹‹å, å‡½æ•°å°±èƒ½å¤Ÿå‚ä¸åˆ°æ•°æ®æµä¸­äº†.</strong> å¦‚æœå‡½æ•°æ¥å—çš„å‚æ•°å˜åŒ–äº†, é‚£ä¹ˆå‡½æ•°æœ¬èº«ä¹Ÿä¼šå˜åŒ–, å¦åˆ™å°±ä¸ä¼šå˜åŒ–. ç”±äº <code class="language-text">useCallback</code> çš„åŠŸèƒ½è¶³å¤Ÿå®Œå–„, å±æ€§çš„å˜åŒ–, å¦‚ <code class="language-text">props.fetchData</code> ä¹Ÿä¼šä¼ é€’ä¸‹å».</p>
<p>ç±»ä¼¼åœ°, <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code class="language-text">useMemo</code></a> ä¹Ÿæä¾›äº†ä¸ <code class="language-text">useCallback</code> ç±»ä¼¼çš„åŠŸèƒ½, ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿé’ˆå¯¹å¤æ‚çš„å¯¹è±¡åšå‡ºç±»ä¼¼çš„å¤„ç†:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ColorPicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸è¦ç ´å Child ç»„ä»¶é’ˆå¯¹å±æ€§æ£€æŸ¥çš„æµ…æ¯”è¾ƒ</span>
  <span class="token comment">// é™¤é color çœŸæ­£å˜åŒ–äº†</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"pink"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æˆ‘æƒ³è¦é‡ç‚¹å£°æ˜çš„ä¸€ç‚¹æ˜¯, å¦‚æœå¯¹æ¯ä¸€ä¸ªå‡½æ•°éƒ½ç”¨ <code class="language-text">useCallback</code> åŒ…è£¹, ä»£ç ä¼šæ˜¾å¾—ååˆ†ç¬¨é‡.</strong> æœ‰ä¸€ç§æ–¹å¼å¯ä»¥é¿å…è¿™ç§å½¢å¼çš„ä»£ç , å½“ä¸€ä¸ªå‡½æ•°é€šè¿‡ props ä¼ é€’, å¹¶ä¸”åœ¨å­ç»„ä»¶å†…éƒ¨è¢«è°ƒç”¨çš„æ—¶å€™, è¿™æ ·çš„æ–¹å¼ä¼šå¾ˆæœ‰ç”¨. å½“ä½ å¸Œæœ›é¿å…ç ´åå­ç»„ä»¶çš„ç¼“å­˜çš„æ—¶å€™, è¿™ç§æ–¹å¼ä¹ŸåŒæ ·æœ‰ç”¨. <mark>But Hooks lend themselves better to avoiding passing callbacks down altogether.</mark></p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘æ›´åå‘äºå¸Œæœ› <code class="language-text">fetchData</code> åœ¨æˆ‘çš„å‰¯ä½œç”¨å‡½æ•°ä¸­(æŠ½å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Hook)æˆ–è€…åœ¨é¡¶å±‚çš„ <code class="language-text">import</code> ä¸­å£°æ˜. æˆ‘å¸Œæœ›å‰¯ä½œç”¨å‡½æ•°å°½å¯èƒ½ä¿æŒç®€å•, å†…éƒ¨å£°æ˜å¤ªå¤šå›è°ƒå‡½æ•°ä¼šå¢åŠ å‰¯ä½œç”¨å‡½æ•°çš„å¤æ‚æ€§. (â€œWhat if some <code class="language-text">props.onComplete</code> callback changes while the request was in flight?â€) ä½ å¯ä»¥<a href="https://overreacted.io/a-complete-guide-to-useeffect/#swimming-against-the-tide">æ¨¡æ‹Ÿç±»å¼ç»„ä»¶çš„è¡Œä¸º</a>, ä½†æ˜¯è¿™å¹¶æ²¡æœ‰è§£å†³ç«é€Ÿåœºæ™¯çš„é—®é¢˜.</p>
<h3 id="ç«é€Ÿåœºæ™¯" style="position:relative;"><a href="#%E7%AB%9E%E9%80%9F%E5%9C%BA%E6%99%AF" aria-label="ç«é€Ÿåœºæ™¯ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç«é€Ÿåœºæ™¯</h3>
<p>ä»¥ä¸€ä¸ªå…¸å‹çš„æ•°æ®è¯·æ±‚åœºæ™¯ä½œä¸ºç¤ºä¾‹:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¯ä»¥çœ‹å‡ºæ¥, ä»¥ä¸Šçš„ä»£ç å…¶å®æ˜¯æœ‰ bug çš„. å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µ. ç°åœ¨æˆ‘ä»¬åŠ ä¸Šæ›´æ–°çš„é€»è¾‘:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åé¢ä¸€æ®µä»£ç ç¤ºä¾‹åšå‡ºäº†ä¸€äº›ä¼˜åŒ–, ä½†æ˜¯ä¾ç„¶å­˜åœ¨é—®é¢˜: æ•°æ®è¯·æ±‚å¯èƒ½ä¼šå‡ºç°é¡ºåºé”™ä¹±çš„æƒ…å†µ. æ¯”å¦‚è¯´, å½“æˆ‘ç”¨ <code class="language-text">{id: 10}</code> æ‰§è¡Œè¯·æ±‚çš„æ—¶å€™, id å˜æˆäº† 20, åœ¨å®é™…çš„è¯·æ±‚è¿‡ç¨‹ä¸­, æˆ‘ä»¬å¯èƒ½ä¼šå…ˆè·å–åˆ° <code class="language-text">{id: 20}</code> çš„è¯·æ±‚ç»“æœ, è¿™æ ·çš„ç°è±¡å°±ä¼šå¯¼è‡´ state ä¸­å­˜å‚¨çš„ç»“æœå‡ºç°æ··ä¹±.</p>
<p>è¿™æ ·çš„ç°è±¡å«åš: ç«é€Ÿåœºæ™¯(Race Condition), åœ¨å­˜åœ¨ <code class="language-text">async</code> / <code class="language-text">await</code> å’Œæ•°æ®æµè‡ªä¸Šè€Œä¸‹ä¼ é€’çš„ä»£ç ä¸­, ç»å¸¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ(å®ƒå‡è®¾äº†æŸäº›å€¼ä¼šç­‰å¾…å¼‚æ­¥çš„ç»“æœ, ä½†æ˜¯ä»£ç æ‰§è¡Œåˆ°å¼‚æ­¥å‡½æ•°çš„ä¸­é—´æ—¶, props æˆ–è€… state å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–.)</p>
<p>è™½ç„¶åœ¨ä½ ä¼ é€’ <code class="language-text">async</code> å‡½æ•°åˆ°å‰¯ä½œç”¨å‡½æ•°ä¸­æ—¶, ä¼šæŠ›å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯, ä½†æ˜¯è¿™ä»…ä»…æ˜¯è­¦å‘Š, å‰¯ä½œç”¨å‡½æ•°å¹¶æ²¡æœ‰èƒ½åŠ›è§£å†³è¿™ä¸ªé—®é¢˜. (ä¹‹åæˆ‘ä»¬ä¼šæ”¹è¿›è¿™ä¸ªè­¦å‘Š, ä»¥æŠ«éœ²å‡ºæ›´å¤šæœ‰æ•ˆä¿¡æ¯, å‘Šè¯‰ç”¨æˆ·è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ä¼šé‡åˆ°çš„é—®é¢˜.)</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹æ³•æ”¯æŒè¢«å–æ¶ˆçš„è¯, å¯ä»¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆè¿™ä¸ªå¼‚æ­¥æ“ä½œ, æ¥è§£å†³ä»¥ä¸Šçš„é—®é¢˜.</p>
<p>é™¤äº†è¿™ç§æ–¹å¼ä¹‹å¤–, è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•: æ·»åŠ ä¸€ä¸ªæ ‡å¿—æ¥è¿½è¸ªè¯·æ±‚æ˜¯å¦è¢«å–æ¶ˆ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>article<span class="token punctuation">,</span> setArticle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">let</span> didCancel <span class="token operator">=</span> <span class="token boolean">false</span></span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didCancel<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>        <span class="token function">setArticle</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      didCancel <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data">è¿™ç¯‡æ–‡ç« </a>è¯¦ç»†é˜é‡Šäº†ä½ åº”è¯¥å¦‚ä½•å¤„ç†å¼‚å¸¸æƒ…å†µå’ŒåŠ è½½çš„çŠ¶æ€, ç®€å•æ¦‚æ‹¬å°±æ˜¯å°†è¿™éƒ¨åˆ†é€»è¾‘æå–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ Hook ä¸­. å¦‚æœæƒ³è¦å­¦ä¹ æ›´å¤šæœ‰å…³äºå¦‚ä½•ä½¿ç”¨ Hook è¯·æ±‚æ•°æ®çš„å†…å®¹çš„è¯, å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« .</p>
<h3 id="è¿›ä¸€æ­¥æ·±å…¥" style="position:relative;"><a href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B7%B1%E5%85%A5" aria-label="è¿›ä¸€æ­¥æ·±å…¥ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è¿›ä¸€æ­¥æ·±å…¥</h3>
<p>åœ¨ç±»ç»„ä»¶(ç”Ÿå‘½å‘¨æœŸ)çš„å¿ƒæ™ºæ¨¡å‹ä¸‹, å‰¯ä½œç”¨å‡½æ•°çš„è¡Œä¸ºå’Œæ¸²æŸ“çš„ç»“æœæœ‰ä¸€å®šå·®å¼‚. UI çš„æ¸²æŸ“ç”± props å’Œ state çš„å˜åŒ–é©±åŠ¨, å¹¶ä¸”ä¼šç¡®ä¿æ¸²æŸ“ç»“æœä¸ä¸¤è€…çš„å˜åŒ–å§‹ç»ˆä¿æŒä¸€è‡´. ä½†æ˜¯åœ¨å‰¯ä½œç”¨çš„å¿ƒæ™ºæ¨¡å‹ä¸‹, æƒ…å†µå°±ä¸æ˜¯è¿™æ ·äº†. å¯¹ä¸¤è€…çš„æ··æ·†, ä¹Ÿç»å¸¸ä¼šå¼•èµ·ä¸€äº› bug.</p>
<p>åœ¨ <code class="language-text">useEffect</code> çš„å¿ƒæ™ºæ¨¡å‹ä¸‹, é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰åœºæ™¯éƒ½æ˜¯åŒæ­¥çš„. å‰¯ä½œç”¨å‡½æ•°å˜æˆäº† React æ•°æ®æµçš„ä¸€éƒ¨åˆ†. å¦‚æœå¼€å‘è€…å¯¹äºæ¯ä¸€ä¸ª <code class="language-text">useEffect</code> éƒ½æ­£ç¡®å¤„ç†çš„è¯, ç»„ä»¶ä¹Ÿèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†æç«¯æƒ…å†µ.</p>
<p>ç„¶è€Œ, å¤„ç†å¥½ <code class="language-text">useEffect</code> çš„æˆæœ¬å¾ˆå¤§ä¹Ÿå¾ˆç¹ç. ç¼–å†™åŒæ­¥çš„ä»£ç , å¤„ç†æç«¯æƒ…å†µ, æ¯”å¤„ç†ä¸€æ¬¡æ€§çš„å‰¯ä½œç”¨(ä¸ä¸¥æ ¼ä¸æ¸²æŸ“çš„ç»“æœä¿æŒä¸€è‡´)éš¾åº¦å¤§ä¸Šå¾ˆå¤š.</p>
<p>å¦‚æœæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ° <code class="language-text">useEffect</code> çš„è¯, æƒ…å†µå°±ä¼šå˜å¾—å¾ˆç¹ç. å¹¸è¿çš„æ˜¯, <code class="language-text">useEffect</code> æ˜¯ä¸€ä¸ªè¾ƒä¸ºåº•å±‚çš„ API. å› ä¸ºç›®å‰å°šå¤„äº Hooks å‡ºç°çš„æ—©æœŸé˜¶æ®µ, å› æ­¤å¤§å®¶ä¼šæ¯”è¾ƒç»å¸¸ä½¿ç”¨å®ƒ, ç‰¹åˆ«æ˜¯åœ¨æŸäº›æ•™ç¨‹ä¸­. éšç€æ—¶é—´çš„å‘å±•, ç¤¾åŒºä¼šå‡ºç°æ›´å¤šé«˜é˜¶çš„ Hooks API, è¿™æ ·ä¸€æ¥, <code class="language-text">useEffect</code> çš„ä½¿ç”¨åœºæ™¯å°±ä¼šå˜å°‘.</p>
<p>æ®æˆ‘äº†è§£, ç›®å‰å·²ç»æœ‰è®¸å¤šåº”ç”¨, å®ç°äº†ä¸€äº›è‡ªå·±çš„ Hooks, æ¯”å¦‚ <code class="language-text">useFetch</code>, é™¤äº†åŸºæœ¬åŠŸèƒ½ä¹‹å¤–, è¿˜å°è£…äº†ä¸€äº›é‰´æƒé€»è¾‘. æ¯”å¦‚ <code class="language-text">useTheme</code>, åˆ™æ˜¯åˆ©ç”¨ context å®ç°äº†åˆ‡æ¢ä¸»é¢˜çš„åŠŸèƒ½. ä¸€æ—¦æˆ‘ä»¬å°è£…äº†ç±»ä¼¼çš„è‡ªå®šä¹‰ Hooks, ç”¨åˆ° <code class="language-text">useEffect</code> çš„åœºæ™¯, è‡ªç„¶ä¹Ÿå°±å˜å°‘äº†. å°½ç®¡ <code class="language-text">useEffect</code> ä¸Šæ‰‹æ¯”è¾ƒå¤æ‚, ä½†æ˜¯å®ƒçš„èƒ½åŠ›ä¹Ÿä¸ºåŸºäºå®ƒå®ç°çš„ Hooks å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©.</p>
<p>æˆªæ­¢ç›®å‰, <code class="language-text">useEffect</code> çš„å¤§éƒ¨åˆ†ä½¿ç”¨åœºæ™¯éƒ½æ˜¯è¯·æ±‚æ•°æ®. ä½†æ˜¯å®é™…ä¸ŠåŒæ­¥çš„ç‰¹æ€§å¯¹æ•°æ®è¯·æ±‚çš„åœºæ™¯å¹¶æ²¡æœ‰ä»€ä¹ˆå¤§å½±å“, ç‰¹åˆ«æ˜¯å¤§éƒ¨åˆ†æ•°æ®è¯·æ±‚çš„åœºæ™¯ä¸‹, æˆ‘ä»¬çš„ä¾èµ–å‚æ•°ç»å¸¸æ˜¯ç©ºæ•°ç»„: <code class="language-text">[]</code>, å°±æ›´ä¸ä¼šæœ‰å¤ªå¤§çš„å½±å“äº†. é‚£ä¹ˆåŒæ­¥çš„ç‰¹æ€§, ä¸»è¦æ˜¯ç”¨äºå½±å“ä»€ä¹ˆçš„å‘¢?</p>
<p>ä»é•¿è¿œè§’åº¦çœ‹, ä¸“é—¨ç”¨ä»¥è¯·æ±‚æ•°æ®çš„ <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching">Suspense ç‰¹æ€§</a> ä½¿å¾—ç¬¬ä¸‰æ–¹åº“èƒ½å¤Ÿç›´æ¥å‘Šè¯‰ React å»¶è¿Ÿæ¸²æŸ“çš„æµç¨‹, ç›´åˆ°æŸäº›å¼‚æ­¥çš„æµç¨‹ç»“æŸå†å¼€å§‹æ¸²æŸ“.</p>
<p>éšç€ Suspense é€æ¸è¦†ç›–è¶Šæ¥è¶Šå¤šçš„æ•°æ®è¯·æ±‚åœºæ™¯, æˆ‘çŒœæµ‹ <code class="language-text">useEffect</code> ä¼šé€æ¸ç”¨äºå…¶ä»–éœ€è¦åŒæ­¥ props å’Œ state è‡³å‰¯ä½œç”¨å‡½æ•°ä¸­çš„åœºæ™¯. <code class="language-text">useEffect</code> çš„è®¾è®¡åˆè¡·, ä¹Ÿæ˜¯å¤„ç†è¿™æ ·çš„åœºæ™¯, è€Œå¹¶éæ•°æ®è¯·æ±‚. åˆ°é‚£æ—¶å€™, ç±»ä¼¼<a href="https://www.robinwieruch.de/react-hooks-fetch-data">è¿™ç¯‡æ–‡ç« </a>ä¸­çš„è‡ªå®šä¹‰ Hooks, å°±ä¼šæ›´å¤šåœ°è¢«ç”¨äºæ•°æ®è¯·æ±‚.</p>
<h3 id="æ€»ç»“" style="position:relative;"><a href="#%E6%80%BB%E7%BB%93" aria-label="æ€»ç»“ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ€»ç»“</h3>
<p>æˆ‘å·²ç»å‘å¤§å®¶ä»‹ç»äº†æˆ‘æ‰€äº†è§£çš„å…³äº <code class="language-text">useEffect</code> çš„çŸ¥è¯†ç‚¹å’Œä½¿ç”¨åœºæ™¯. ç°åœ¨å¯ä»¥å†å›çœ‹æ–‡ç« æœ€å¼€å§‹çš„<a href="https://overreacted.io/a-complete-guide-to-useeffect/#tldr">å¤ªé•¿ä¸çœ‹</a>éƒ¨åˆ†çš„å†…å®¹. æ˜¯å¦å¯¹å®ƒä»¬æœ‰æ›´æ·±å…¥çš„ç†è§£äº†å‘¢?</p></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/d4bf4/photo.avif 50w,/blog/static/0d1ae485b869926285547d68f24089ad/ee81f/photo.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/3faea/photo.webp 50w,/blog/static/0d1ae485b869926285547d68f24089ad/6a679/photo.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg 50w,/blog/static/0d1ae485b869926285547d68f24089ad/64618/photo.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/d4bf4/photo.avif 50w,/blog/static/0d1ae485b869926285547d68f24089ad/ee81f/photo.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/3faea/photo.webp 50w,/blog/static/0d1ae485b869926285547d68f24089ad/6a679/photo.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg 50w,/blog/static/0d1ae485b869926285547d68f24089ad/64618/photo.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/before-you-memo/">â† <!-- -->åœ¨ä½¿ç”¨ memo ä¹‹å‰</a></li><li></li></ul></nav></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/a-complete-guide-to-useeffect/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-56e919f1fc9a731e5927.js"],"app":["/app-2226f01a9ae9a3fde7ee.js"],"component---src-pages-404-js":["/component---src-pages-404-js-02dee739284fbee12e4e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-8d06a138a82d686eac0f.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ed6fa9d078c752cee965.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-49536cdc753c1e44b042.js"]};/*]]>*/</script><script src="/blog/polyfill-56e919f1fc9a731e5927.js" nomodule=""></script><script src="/blog/component---src-templates-blog-js-49536cdc753c1e44b042.js" async=""></script><script src="/blog/commons-ff66217271001e5b3970.js" async=""></script><script src="/blog/app-2226f01a9ae9a3fde7ee.js" async=""></script><script src="/blog/framework-b2b1b62bddbed1246653.js" async=""></script><script src="/blog/webpack-runtime-45df45a5891ba014dba8.js" async=""></script></body></html>