<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><style data-href="/blog/styles.e151c0c0c1197749234d.css" id="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format("woff");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format("woff");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmhdu3cOWxy40.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwkxdu3cOWxy40.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmxdu3cOWxy40.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmRdu3cOWxy40.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlxdu3cOWxw.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lujVj9_mf.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lujVj9_mf.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lujVj9_mf.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lujVj9_mf.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lujVj9_mf.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lujVj9_mf.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmhdu3cOWxy40.woff2) format("woff2");unicode-range:U+0460-052f,U+1c80-1c88,U+20b4,U+2de0-2dff,U+a640-a69f,U+fe2e-fe2f}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwkxdu3cOWxy40.woff2) format("woff2");unicode-range:U+0400-045f,U+0490-0491,U+04b0-04b1,U+2116}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmxdu3cOWxy40.woff2) format("woff2");unicode-range:U+1f??}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0370-03ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmBdu3cOWxy40.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01a0-01a1,U+01af-01b0,U+1ea0-1ef9,U+20ab}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmRdu3cOWxy40.woff2) format("woff2");unicode-range:U+0100-024f,U+0259,U+1e??,U+2020,U+20a0-20ab,U+20ad-20cf,U+2113,U+2c60-2c7f,U+a720-a7ff}@font-face{font-display:swap;font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdu3cOWxw.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}html{scroll-behavior:smooth}body{--body-color:#c4b6fd;--font:"Source Sans Pro","Helvetica Neue",Arial,sans-serif;background-color:var(--bg);font-family:var(--font)}body.light{--bg:#fff;--bg-secondary:#f9fafb;--header:var(--body-color);--textNormal:#2c3e50;--textTitle:#2c3e50;--textLink:#a88bfa;--hr:rgba(0,0,0,0.2);--inlineCode-bg:#f8f8f8;--inlineCode-text:#d63200;--form-shadow:0 2px 15px 0 rgba(210,214,220,0.5)}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--bg-secondary:#363c48;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--body-color);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#ffe56433;--inlineCode-text:#e6e6e6;--form-shadow:0 2px 15px 0 rgba(26,26,27,0.637)}h1,h2,h3,h4,h5,h6{font-family:var(--font)}a{box-shadow:none;text-decoration:none}a:hover{text-decoration:underline}mark{background:#f59e0b}.title_list{list-style:none}.title_list article section p{color:#8aa4be}.title_list h3{margin-bottom:5px}.title_list a{color:var(--textTitle)}.title_list a:hover{color:var(--textLink);text-decoration:none}.bio-avatar{margin-bottom:20px}code[class*=language-],pre[class*=language-]{font-feature-settings:normal;word-wrap:normal;background:none;color:#fff;font-family:Roboto Mono,Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{background:hsla(0,0%,100%,.15);text-shadow:none}:not(pre)>code[class*=language-]{background:var(--inlineCode-bg);border-radius:.3em;color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;border-left:.25em solid #ffa7c4;display:block;padding-left:1.25em;padding-right:1em}.gatsby-highlight,.gatsby-highlight-code-line{margin-left:-1.3125rem;margin-right:-1.3125rem}.gatsby-highlight{-webkit-overflow-scrolling:touch;background:#011627;border-radius:10px;margin-bottom:1.75rem;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;background-color:transparent;border:0;cursor:pointer;display:inline-block;padding:0;position:relative;touch-action:pan-x;-webkit-user-select:none;-ms-user-select:none;user-select:none}.react-toggle-screenreader-only{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{background-color:#0f1114;border-radius:30px;height:24px;padding:0;transition:all .2s ease;width:50px}.react-toggle-track-check{bottom:0;height:17px;left:5px;line-height:0;margin-bottom:auto;margin-top:auto;opacity:0;position:absolute;top:0;transition:opacity .25s ease;width:17px}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{bottom:0;height:17px;line-height:0;margin-bottom:auto;margin-top:auto;position:absolute;right:5px;top:0;width:17px}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{background-color:#fafafa;border-radius:50%;box-sizing:border-box;height:22px;left:1px;position:absolute;top:1px;transform:translateX(0);transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;width:22px}.react-toggle--checked .react-toggle-thumb{border-color:#19ab27;transform:translateX(26px)}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #c4b6fd}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #c4b6fd}h3.title{margin-bottom:28px;padding-left:15px}ul.table_list{border-radius:.25rem;display:flex;flex-direction:column;left:calc(50% + 400px);margin-bottom:.75rem;margin-top:.75rem;max-height:27rem;max-width:15rem;position:fixed;top:7rem}.table_list li{line-height:1rem;list-style:none;margin-bottom:1em;padding:.25rem}.table_list a{color:var(--color-primary);text-decoration:none}.table_list a.active,.table_list a:hover{color:#a78bfa;text-decoration:none;transition-duration:.3s}.table_list a.active{border-radius:.125rem}.headings{overflow:auto}</style><meta name="generator" content="Gatsby 3.6.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8f03a5daec1c1aec2f99e70f83851e31" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#a88bfa"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8f03a5daec1c1aec2f99e70f83851e31"/><title data-react-helmet="true">React 如何区分类组件和函数式组件? | Fish&#x27;s Blog</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="How Does React Tell a Class from a Function?"/><meta data-react-helmet="true" property="og:title" content="React 如何区分类组件和函数式组件?"/><meta data-react-helmet="true" property="og:description" content="How Does React Tell a Class from a Function?"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="icyfish_"/><meta data-react-helmet="true" name="twitter:title" content="React 如何区分类组件和函数式组件?"/><meta data-react-helmet="true" name="twitter:description" content="How Does React Tell a Class from a Function?"/><link as="script" rel="preload" href="/blog/webpack-runtime-1c10d4462d6abdb81356.js"/><link as="script" rel="preload" href="/blog/framework-b2b1b62bddbed1246653.js"/><link as="script" rel="preload" href="/blog/app-8cc590526fc91995e11e.js"/><link as="script" rel="preload" href="/blog/commons-ff66217271001e5b3970.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-js-40e0ec0461a2aa11ea07.js"/><link as="fetch" rel="preload" href="/blog/page-data/how-react-tell-a-class-from-a-function/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:#c4b6fd" href="/blog/">Fish&#x27;s Blog</a></h3><div style="height:24px"></div></header><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">React 如何区分类组件和函数式组件?</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem"><p>January 15, 2020<span style="margin-left:10px">☕️☕️☕️ 17 min read</span></p></p></header><section itemProp="articleBody"><p>原文: <a href="https://overreacted.io/how-does-react-tell-a-class-from-a-function/">How Does React Tell a Class from a Function?</a></p>
<p>下面这个 <code class="language-text">Greeting</code> 是一个函数式 React 组件:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>React 同样支持以类的形式定义一个组件:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(函数式组件可以通过 <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a> 保存状态)</p>
<p>不过当我们使用一个组件的时候, 我们并不在意它是如何定义的:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Class or function — whatever.</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>不过 React 本身对组件是函数式还是类式, 十分在意.</p>
<p>如果 <code class="language-text">Greeting</code> 是函数式组件, React 的使用方式就是调用它:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Your code</span>
<span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Inside React</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>如果 <code class="language-text">Greeting</code> 是类式组件, React 的使用方式就是使用 <code class="language-text">new</code> 操作符来实例化这个组件, 并调用所创建实例的 <code class="language-text">render</code> 方法.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Your code</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Inside React</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting {}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>以上两种情况下, React 的目标都是获取需要被渲染的 DOM 节点(在我们的例子中是 <code class="language-text">&lt;p&gt;Hello&lt;/p&gt;</code> ). 具体的获取步骤, 还是根据 <code class="language-text">Greeting</code> 如何被定义来决定.</p>
<p><strong>那么 React 是如何知道组件是类还是函数的呢?</strong></p>
<p>就像我在<a href="https://overreacted.io/why-do-we-write-super-props/">这篇文章</a>中说的, 即使不知道这点, <strong>你也能够高效地用 React 构建出 web 应用.</strong> 我也并不是一开始就了解这个知识的, 因此请不要将这个知识点作为面试题询问求职者. 实际上, 这篇文章所涉及的知识更偏向于 JavaScript 而不是 React.</p>
<p>这篇文章的目标读者是对 React 的底层原理有好奇心的开发者, 如果你是的话, 那么就让我们一起探索吧.</p>
<p><strong>我们的探索旅程会很长. 请系好安全带. 本文涉及到的 React 知识点其实并不多, 更多的是关于 JavaScript 的知识点, 比如说: <code class="language-text">new</code> , <code class="language-text">this</code> , <code class="language-text">class</code> , 箭头函数, <code class="language-text">prototype</code> , <code class="language-text">__proto__</code>, <code class="language-text">instanceof</code> 等. 幸运的是, 当你在使用 React 的时候, 并不需要特别考虑这些. 不过站在 React 的开发者角度, 情况就不一样了…</strong></p>
<p>(如果你不希望了解实现细节, 只想要知道答案, 请直接查看文末的内容.)</p>
<hr>
<p>首先我们需要理解, 为什么区别对待函数式组件和类组件是重要的. 当我们调用类组件时候, 需要依赖 <code class="language-text">new</code> 操作符:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// 如果 Greeting 是函数式组件, 在react内部会被这样调用</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span>
<span class="token comment">// 如果 Greeting 是 class 组件, 在react内部会被这样调用</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting {}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>现在我们重点关注一下, <code class="language-text">new</code> 操作符在 JavaScript 中具体做了些什么.</p>
<hr>
<p>过去 JavaScript 中没有类的概念. 但是我们可以构造一个与类有类似功能的函数. 具体见下面的例子, 针对这种特殊的函数, 我们使用 <code class="language-text">new</code>关键字进行调用.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// 只是一个函数</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Person {name: 'Fred'}</span>
<span class="token keyword">var</span> george <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 不会起作用, </span>
<span class="token comment">// 如果将代码在控制台执行, 会发现 this 指向全局 window.name 是 George</span></code></pre></div>
<p>如果我们调用 <code class="language-text">Person(&#39;Fred&#39;)</code> 时没有加上 <code class="language-text">new</code> 关键字, 函数中的 <code class="language-text">this</code> 会指向全局, 那么这个 <code class="language-text">this</code> 就一点意义也没有了. 我们的代码会崩溃, 同时还做了件蠢事: 创建了一个无用的全局变量.</p>
<p><strong>那么使用 <code class="language-text">new</code> 调用函数时具体发生了些什么呢?</strong></p>
<p>在调用函数时添加<code class="language-text">new</code>, 相当于告诉 JavaScript, <code class="language-text">Person</code>虽然只是个函数, 但是我们可以把它看做类构造器. <strong>此时 JavaScript 就会创建一个<code class="language-text">{}</code>对象, 然后<code class="language-text">Person</code>中的<code class="language-text">this</code>值指向该对象, 同时将 <code class="language-text">name</code> 设置为该对象的属性, 并且 <code class="language-text">return</code> 出该对象.</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Same object as `this` inside `Person`</span></code></pre></div>
<p>通过以上的 <code class="language-text">new</code> 调用, 对象 <code class="language-text">fred</code> 还可以读取构造器函数 <code class="language-text">Person.prototype</code> 上的属性.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>在 JavaScript 不原生支持<code class="language-text">class</code>之前, 开发者就是通过这种方式模拟类的.</p>
<hr>
<p><code class="language-text">new</code> 关键字存在已久, 而 <code class="language-text">class</code> 的支持却是近段时间的事. 现在我们使用<code class="language-text">class</code>改写先前的代码.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>在设计编程语言和 API 时, 用户的痛点至关重要.</p>
<p>开发者在编写函数时, JavaScript 无法猜测到函数是需要被直接调用还是在之前加关键词 <code class="language-text">new</code> 调用.  因此开发者在调用类似 <code class="language-text">Person</code> 这样的构造函数时, 务必记得在前面添加 <code class="language-text">new</code> 关键字, 否则就会给程序引入一些令人疑惑的问题.</p>
<p><strong>有了 Class 语法之后, 我们的语境中就有了类的概念, 对于这类特殊的函数, 我们就能说, 它不仅仅是一个函数, 而是一个类, 同时有自己的构造函数.</strong> 如果你在调用它的时候忘了加上 <code class="language-text">new</code> 关键字, JavaScript 就会抛出错误.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ✅  If Person is a function: works fine</span>
<span class="token comment">// ✅  If Person is a class: works fine too</span>

<span class="token keyword">let</span> george <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// We forgot `new`</span>
<span class="token comment">// 😳 If Person is a constructor-like function: confusing behavior</span>
<span class="token comment">// 🔴 If Person is a class: fails immediately</span></code></pre></div>
<p>这样一来, 我们就避免写出造成许多隐藏bug的代码, 比如 <code class="language-text">this.name</code> 被当作是 <code class="language-text">window.name</code> 而不是我们所预期的 <code class="language-text">george.name</code> .</p>
<p>不过如果 React 也必须遵循这个原则的话, 那么在调用任何类组件的时候, 就必须在之前加上 <code class="language-text">new</code> 关键字, 否则的话 JavaScript 就会抛出异常.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 🔴 React 无法这样做</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">Counter</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<hr>
<p>那么 React 是如何解决这个问题的呢? 大多数开发者在使用React时会同时使用<code class="language-text">Babel</code> 来编译最新语法的代码以兼容旧版本的浏览器. 因此我们把解决方案的头绪放在了编译器上.</p>
<p>在前几个版本的 <code class="language-text">Babel</code> 中, 类可以不需要声明 <code class="language-text">new</code> 关键字直接调用, 但是这个问题很快被 <code class="language-text">Babel</code> 团队修复了, 我们来看一下他们的修复方式:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// A bit simplified from Babel output:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"Cannot call a class as a function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Our code:</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Okay</span>
<span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 🔴 Cannot call a class as a function</span></code></pre></div>
<p>如果你看过项目打包之后的代码的话, 可能会觉得这个函数似曾相识, 这个就是<code class="language-text">_classCallCheck</code> 函数所做的事情. (你可以通过开启”宽松检查模式”来减少打包之后代码的量, 但是这当然也带来了一个问题: 当处理真正的原生类语法时, 情况会变得更加复杂. You can reduce the bundle size by opting into the “loose mode” with no checks but this might complicate your eventual transition to real native classes.)</p>
<hr>
<p>至此, 我们明白了调用函数时加 <code class="language-text">new</code> 与不加 <code class="language-text">new</code> 的区别:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/b1584/compare.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY02WQbW/DIAyE8///4fZl69SmbVoILzGEBHgq2NZJq6WT0J199jHUWmlVqWxbJCUhrUItmSY1/dlTS9dSCk/ufw3fjW0SnJqYLp9czx/kvL0055K53o7crl8/J/wt/MUQZG4sW9k4hAMhOEKIxGARMSilsNaQa6WESLqMxOhYg6OUTCnliW7o7L1v30tmlCPWTDhnabyzGqU0Zp4pzTCuyHhCqTPi9UuCFnQw84Uolr1m3t1bN2wXeXfHO8U0TWitKaVF2gjLCe/mDn0/YY1Gq7G/9z0xLF6R1tD/5xYnZJkRkR45iMNai/ee3CKVTAoGWZrmWZaZGARZTJ/L+8YDy9jSTEwfmN4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="compare"
        title="compare"
        src="/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/f058b/compare.png"
        srcset="/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/c26ae/compare.png 158w,
/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/6bdcf/compare.png 315w,
/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/f058b/compare.png 630w,
/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/40601/compare.png 945w,
/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/78612/compare.png 1260w,
/blog/static/8f85f250c2e88ac0c3065d7bf92aec5f/b1584/compare.png 1342w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>这就是为什么, 在React中, 正确调用组件是多么重要. <strong>如果组件被定义为类组件, React必须在前添加 <code class="language-text">new</code> 关键字进行调用.</strong></p>
<p>那么 React 是否可以不依赖任何其他信息区分出组件是函数式组件还是class组件呢?</p>
<p>并不简单. 虽然我们<a href="https://stackoverflow.com/questions/29093396/how-do-you-check-the-difference-between-an-ecmascript-6-class-and-function">在 JavaScript 中可以区分出 class 函数和普通函数</a>, 但是被 <code class="language-text">Babel</code> 处理过的代码, 就很难区分了. 因为经过处理之后, 对于浏览器来说, 它们都是普通的函数. 不过在 React 中, 我们还是有办法处理的.</p>
<hr>
<p>或许 React 可以针对每一次调用都加上 <code class="language-text">new</code> 关键字? 遗憾的事, 这样的方式并不靠谱. </p>
<p>调用普通函数时添加 <code class="language-text">new</code> 关键字会为该函数创建一个对象实例. 针对构造器函数, 使用 <code class="language-text">new</code> 调用是预期行为, 但是针对函数式组件, 这种调用方式就会让人觉得疑惑.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// We wouldn’t expect `this` to be any kind of instance here</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>以上这个原因并没有到不能接受的程度, 但是还有其他两个重要原因决定了不可以始终添加 <code class="language-text">new</code> 关键词进行函数调用.</p>
<hr>
<p>第一个原因是使用 <code class="language-text">new</code> 调用箭头函数(未被 Babel 编译过) 会抛出异常:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Greeting</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Greeting is not a constructor</span></code></pre></div>
<p>由于不符合箭头函数的设计语法, JavaScript 有意限制了这种行为. 箭头函数最主要的特点之一是没有自己的 <code class="language-text">this</code> , 如果在箭头函数内部使用 <code class="language-text">this</code> 的话, <code class="language-text">this</code> 的值会由离它最近的普通函数决定.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Friends</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> friends <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>friends<span class="token punctuation">;</span>
    <span class="token keyword">return</span> friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">friend</span> <span class="token operator">=></span>
      <span class="token operator">&lt;</span>Friend
        <span class="token comment">// `this` is resolved from the `render` method</span>
        size<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>size<span class="token punctuation">}</span>
        name<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
        key<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>箭头函数没有自己的 <code class="language-text">this</code>. 因此我们没有办法将箭头函数改造为构造器函数.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 🔴 This wouldn’t make sense!</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>JavaScript</strong> 禁止了使用 <code class="language-text">new</code> 调用箭头函数的行为. 也是由于同样的原因, 我们必须使用 <code class="language-text">new</code> 关键词实例化一个类. </p>
<p>因此, 在React中用 <code class="language-text">new</code> 调用函数是不合理的. 那么针对这种情况, 我们是否可以检测出函数是否为箭头函数(如果没有 <code class="language-text">prototype</code> , 则非箭头函数), 然后针对它做些特殊处理 (不要用 <code class="language-text">new</code> 去调用它).</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype <span class="token comment">// {constructor: f}</span></code></pre></div>
<p>但是函数经过Babel编译之后, 就<a href="https://github.com/facebook/react/issues/4599#issuecomment-136562930">不能够用以上的方式判断</a>了. 编译之后的结果:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token string">"use strict"</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> </code></pre></div>
<p>不过这个问题比较好解决, 影响比较严重的是另一个原因:</p>
<hr>
<p>当函数的返回值是字符串或其他原始类型时, 使用 <code class="language-text">new</code> 对其进行调用不会得到我们预期的结果.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 'Hello'</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Greeting {}</span></code></pre></div>
<p>这个行为和 <code class="language-text">new</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new">操作符</a>本身的设计有关. 在前文中我们知道, <code class="language-text">new</code> 会告诉 JavaScript 引擎创建一个对象,  <code class="language-text">this</code> 指向所创建的对象实例, 然后 <code class="language-text">return</code> 出该实例.</p>
<p>JavaScript  同样允许函数被 <code class="language-text">new</code> 调用时, 通过控制 <code class="language-text">return</code> 的值来覆盖默认返回的对象.  当在对象池模式下, 想要复用函数实例时, 这种模式就可以发挥作用了. </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Created lazily</span>
<span class="token keyword">var</span> zeroVector <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Vector</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>zeroVector <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Reuse the same instance</span>
      <span class="token keyword">return</span> zeroVector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    zeroVector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😲 b === c</span></code></pre></div>
<p>不过有一点需要注意的是, 当手动 <code class="language-text">return</code> 出的不是对象, 而是字符串或者数字类型, 这些值就无法覆盖默认的对象.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 42</span>
<span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Answer {}</span></code></pre></div>
<p>因此, 如果始终用 <code class="language-text">new</code> 调用函数, <code class="language-text">React</code> 就永远无法支持返回值为数字或者字符串的组件了.</p>
<p>由于这个原因, 我们必须做出一些妥协.</p>
<hr>
<p>至此我们学到了: React 针对类组件调用时(包括经过 Babel 处理的结果), 需要添加 <code class="language-text">new</code> 关键字, 但是普通函数和箭头函数调用却不需要. 可是到目前为止并没有可靠的方法对这两种方式进行区分.</p>
<p><strong>不过我们是否可以转换看问题的角度, 针对通用的问题我们没有办法解决, 那么是不是可以找到一个更具体的问题去解决. If we can’t solve a general problem, can we solve a more specific one?</strong> </p>
<p>当我们定义一个 React 类组件时, 该组件一定会继承 <code class="language-text">React.Component</code> 以便使用 React 的内部方法 <code class="language-text">this.setState()</code> .  <strong>这样的话, 我们是否就不需要检测所有的类, 只需要检测继承 <code class="language-text">React.Component</code> 的组件即可?</strong></p>
<p>剧透: 这就是React的处理方式.</p>
<hr>
<p>现在我们要检测 <code class="language-text">Greeting</code> 是否是一个React 类组件, 最符合直觉的检测方式是 <code class="language-text">Greeting.prototype instanceof React.Component</code> :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre></div>
<p>为了理解以上代码的含义, 我们首先要理解 JavaScript 原型.  </p>
<p>大家对”原型链”这个概念应该已经很熟悉了. 在JavaScript中, 所有对象可能存在一个”原型”. 当我们执行这段代码 <code class="language-text">fred.sayHi()</code> 时, <code class="language-text">fred</code> 这个对象本身可能并不存在 <code class="language-text">sayHi</code> 属性. 我们会从 <code class="language-text">fred</code> 的原型上寻找这个属性. 如果没有找到, 则会再深入原型链寻找 — <code class="language-text">fred</code> 的原型的原型. 直到找到这个属性为止.</p>
<p>但比较令人疑惑的一点是, 类或者函数的 <code class="language-text">prototype</code> 属性与它的原型并不对等.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🤪 Not Person's prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Person's prototype</span></code></pre></div>
<p>原型链的结构是 <code class="language-text">__proto__.__proto__.__proto__</code> 而不是 <code class="language-text">prototype.prototype.prototype</code> .</p>
<p>那这个 <code class="language-text">prototype</code> 属性是什么呢?  当我们用 <code class="language-text">new</code> 实例化一个类或者函数时, 实例的 <code class="language-text">__proto__</code> 属性就是就是类或函数的 <code class="language-text">prototype</code> 属性.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sets `fred.__proto__` to `Person.prototype`</span></code></pre></div>
<p>JavaScript使用<strong><code class="language-text">__proto__</code></strong> 链查询属性:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. Does fred have a sayHi property? No.</span>
<span class="token comment">// 2. Does fred.__proto__ have a sayHi property? Yes. Call it!</span>

fred<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. Does fred have a toString property? No.</span>
<span class="token comment">// 2. Does fred.__proto__ have a toString property? No.</span>
<span class="token comment">// 3. Does fred.__proto__.__proto__ have a toString property? Yes. Call it!</span></code></pre></div>
<p>不过在实际应用中, 你不应该直接使用 <code class="language-text">__proto__</code> , 除非调试时需要查询与原型链相关的信息. 如果你想使某些属性可以利用 <code class="language-text">fred.__proto__</code> 访问, 就应该将该信息放在 <code class="language-text">Person.prototype</code> . 这也是 <code class="language-text">prototype</code> 设计的初衷.</p>
<p><code class="language-text">__proto__</code> 属性其实并不应该暴露给外部, 因为它本质上只给 JavaScript 内部使用. 但是某些浏览器依然支持了该属性甚至将其标准化(不过它会逐渐被 <code class="language-text">Object.getPrototypeOf()</code> 所替代的.)</p>
<p><strong>现在我依然疑惑的是: 对象的 <code class="language-text">prototype</code> 属性对应的值竟然不是对象的原型</strong>(举个例子: <code class="language-text">fred.prototype</code> 的值为 <code class="language-text">undefined</code> , 因为 <code class="language-text">fred</code> 不是一个函数). 个人认为, 这是开发者难以理解 JavaScript 原型概念的主要原因.</p>
<hr>
<p>现在我们知道了, 当我们输入 <code class="language-text">obj.foo</code> 时, JavaScript 实际上会在 <code class="language-text">obj</code> <code class="language-text">obj.__proto__</code>, <code class="language-text">obj.__proto__.__proto__</code> …上寻找 <code class="language-text">foo</code> 属性.</p>
<p>在 JavaScript 类中, 并没有直接暴露这个机制, 不过 <code class="language-text">extends</code> 的实现基于这种原型链机制. 这也是我们的 React 类实例读取 <code class="language-text">setState</code> 方法所利用的机制:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// React.Component.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object.prototype</span>

c<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Found on c.__proto__ (Greeting.prototype)</span>
c<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Found on c.__proto__.__proto__ (React.Component.prototype)</span>
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Found on c.__proto__.__proto__.__proto__ (Object.prototype)</span></code></pre></div>
<p>也就是说, <strong>当我们使用类的时候, 类实例的 <code class="language-text">__proto__</code> 链反映了这种原型链关系:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// `extends` chain</span>
Greeting
  → React<span class="token punctuation">.</span>Component
    → <span class="token function">Object</span> <span class="token punctuation">(</span>implicitly<span class="token punctuation">)</span>

<span class="token comment">// `__proto__` chain</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  → <span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype
    → React<span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype
      → <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype</code></pre></div>
<p>那么既然了解了 <code class="language-text">__proto__</code> 链的概念, 我们就能通过这种方式检查 <code class="language-text">Greeting</code> 是否继承自 <code class="language-text">React.Component</code> , 从 <code class="language-text">Greeting.prototype</code> 开始通过 <code class="language-text">__proto__</code> 不断层层深入.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// `__proto__` chain</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  → <span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype <span class="token comment">// 🕵️ We start here</span>
    → React<span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype <span class="token comment">// ✅ Found it!</span>
      → <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype</code></pre></div>
<p>还有一个更加方便的方式, <code class="language-text">x instanceof Y</code> 也可以实现与以上代码几乎差不多的功能. 跟着 <code class="language-text">x.__proro__</code> 的原型链寻找 <code class="language-text">Y.prototype</code> .</p>
<p>正常情况下, 我们通过这种方式来判断类的实例:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Greeting</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ We start here)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype (✅ Found it!)</span>
<span class="token comment">//     .__proto__ → React.Component.prototype </span>
<span class="token comment">//       .__proto__ → Object.prototype</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ We start here)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype (✅ Found it!)</span>
<span class="token comment">//       .__proto__ → Object.prototype</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ We start here)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype</span>
<span class="token comment">//       .__proto__ → Object.prototype (✅ Found it!)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Banana</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token comment">// greeting (🕵️‍ We start here)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype </span>
<span class="token comment">//       .__proto__ → Object.prototype (🙅‍ Did not find it!)</span></code></pre></div>
<p>同时也能用来判断某个类是否继承自另一个类:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// greeting</span>
<span class="token comment">//   .__proto__ → Greeting.prototype (🕵️‍ We start here)</span>
<span class="token comment">//     .__proto__ → React.Component.prototype (✅ Found it!)</span>
<span class="token comment">//       .__proto__ → Object.prototype</span></code></pre></div>
<p>以上这种方式可以用以区分React 类组件和函数组件.</p>
<hr>
<p>不过React在生产中并不是使用这种方式去检查的. 😳</p>
<p>使用 <code class="language-text">instanceof</code> 的判断方式有个弊端, 当我们的页面中存在多个 React 的拷贝时,  我们检查的某个组件可能继承自另一个 React 拷贝的 <code class="language-text">React.Component</code> . 在一个项目中使用多个 React 拷贝当然是不推荐的做法. 但是由于历史原因, 我们可能会用多个 React 拷贝来解决某些问题. (不过如果我们在项目中使用 Hooks 的话, <a href="https://github.com/facebook/react/issues/13991">我们可能必须要禁止多个拷贝的存在</a>.)</p>
<p>另一个判断方式是, 检查原型链中的 <code class="language-text">render</code> 方法是否存在. 然而, 当时对于<a href="https://github.com/facebook/react/issues/4599#issuecomment-129714112">组件相关的 API 规范并没有完全确定下来.</a> 随时可能会变化. 如果使用这种方式的话, Every check has a cost so we wouldn’t want to add more than one. 同时, 如果 <code class="language-text">render</code> 被定义为实例方法的话, 这种方式也会失效.</p>
<p>因此 React 采用了一种给基础组件<a href="https://github.com/facebook/react/pull/4663">添加</a>特殊标志的方式. React 会检查这个标志是否存在, 通过这个标志来判断这是个类组件还是函数组件.</p>
<p>在最初的实现版本中, 这个标志存在于 <code class="language-text">React.Compoenent</code> 本身:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Inside React</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Component<span class="token punctuation">.</span>isReactClass <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// We can check it like this</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Greeting<span class="token punctuation">.</span>isReactClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Yes</span></code></pre></div>
<p>然而, 一些类在<a href="https://github.com/scala-js/scala-js/issues/1900">实现</a>上并没有拷贝静态属性或者设置非标准的 <code class="language-text">__proto__</code> . 在这种情况下 React 添加的特殊标志就丢失了.</p>
<p>于是React团队<a href="https://github.com/facebook/react/pull/5021">将这个标志转移</a>到了 <code class="language-text">React.Component.prototype</code> 上了:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Inside React</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// We can check it like this</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Yes</span></code></pre></div>
<p>也许很多人会疑惑, 为什么我们的标识不是布尔值而是对象. 这是因为我们在使用 Jest 进行自动化测试时, 前几个版本的 Jest 默认打开了<a href="https://dev.to/slashgear_/discover-jest-hidden-feature-automock-2c9f">automocking</a>, 生成的模拟测试数据会<a href="https://github.com/facebook/react/pull/4663#issuecomment-136533373">忽略原始值</a>, 因此如果用布尔值的话, 会影响自动化测试的结果.</p>
<p><code class="language-text">isReactComponent</code> 的检测方式至今依然在<a href="https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L297-L300">使用</a>. </p>
<p>如果你在编写React组件的时候没有继承 <code class="language-text">React.Component</code> . React就不会在原型链中找到 <code class="language-text">isReactComponent</code> 这个属性, 也不会将其看做 class 组件. 读到这里, 大家可能就都明白<a href="https://stackoverflow.com/questions/38481857/getting-cannot-call-a-class-as-a-function-in-my-react-project/42680526#42680526">这个问题</a>的答案了: 如果在React的开发过程中遇到 <code class="language-text">Cannot call a class as a function</code> 的报错, 记得在使用React 类组件时加上 <code class="language-text">extends React.Component</code> . 同时如果你没有这样使用类组件, 却组件内却定义了 <code class="language-text">render</code> 方法, React也会报出一个<a href="https://github.com/facebook/react/pull/11168">⚠️</a>. </p>
<hr>
<p>你可能会觉得这篇文章有点挂羊头卖狗肉 (<a href="https://en.wikipedia.org/wiki/Bait-and-switch">bait-and-switch</a>) 的感觉. <strong>实际的解决方案那么简单, 可是我们却不直接回答这个问题, 而是饶了那么一大圈去解释为什么替代方案是不可行的.</strong> </p>
<p>在我的经验中, 在实现一个库的 API 时, 这是经常会遇到的情况. 对于一个使用起来很方便的 API, 你必须要深入考虑语言本身的语义, 运行时的性能, 存在/不存在编译步骤时的效率, 相关生态的发展以及打包方案, 早期的告警以及很多其他问题. 最终设计出成果或许不会是最优雅的, 但是肯定是最实用的.</p>
<p>如果最终设计出来的 API 很成功的话, 那么 API 的使用者就完全不需要考虑它的设计过程, 只需要专注于创建应用即可.</p>
<p>如果使用者对 API 的设计感到好奇, 了解它的底层原理当然是很好的.</p></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/d4bf4/photo.avif 50w,/blog/static/0d1ae485b869926285547d68f24089ad/ee81f/photo.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/3faea/photo.webp 50w,/blog/static/0d1ae485b869926285547d68f24089ad/6a679/photo.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg" data-srcset="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg 50w,/blog/static/0d1ae485b869926285547d68f24089ad/64618/photo.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/d4bf4/photo.avif 50w,/blog/static/0d1ae485b869926285547d68f24089ad/ee81f/photo.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/3faea/photo.webp 50w,/blog/static/0d1ae485b869926285547d68f24089ad/6a679/photo.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg" srcSet="/blog/static/0d1ae485b869926285547d68f24089ad/d24ee/photo.jpg 50w,/blog/static/0d1ae485b869926285547d68f24089ad/64618/photo.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li><a rel="next" href="/blog/how-does-setstate-know-what-to-do/">setState如何知道自己应该做什么?<!-- --> →</a></li></ul></nav></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/how-react-tell-a-class-from-a-function/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-56e919f1fc9a731e5927.js"],"app":["/app-8cc590526fc91995e11e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-02dee739284fbee12e4e.js"],"component---src-pages-draft-js":["/component---src-pages-draft-js-193d4caecfae2a634e2b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-8d06a138a82d686eac0f.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ed6fa9d078c752cee965.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-40e0ec0461a2aa11ea07.js"]};/*]]>*/</script><script src="/blog/polyfill-56e919f1fc9a731e5927.js" nomodule=""></script><script src="/blog/component---src-templates-blog-js-40e0ec0461a2aa11ea07.js" async=""></script><script src="/blog/commons-ff66217271001e5b3970.js" async=""></script><script src="/blog/app-8cc590526fc91995e11e.js" async=""></script><script src="/blog/framework-b2b1b62bddbed1246653.js" async=""></script><script src="/blog/webpack-runtime-1c10d4462d6abdb81356.js" async=""></script></body></html>